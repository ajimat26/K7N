<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>UANGDUTY</title>
  <style>
    body {
      font-family: Arial;
      margin: 20px;
    }
    #adminPanel, #buatAkunForm, #chatBox, #userPanel {
      margin-top: 20px;
      display: none;
    }
    button {
      margin: 3px;
    }
    #modeAdminBtn {
      background: red;
      color: white;
    }
    #adminStatus {
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h2>UANGDUTY</h2>
  <button id="modeAdminBtn">Mode Admin</button>
  <span id="adminStatus">(Nonaktif)</span>

  <div id="adminPanel">
    <h3>Panel Admin</h3>
    <button onclick="togglePendaftaran()">Tutup/Buka Pendaftaran</button>
    <p>Status: <span id="pendaftaranStatus">Dibuka</span></p>
    <h4>Data Semua Akun</h4>
    <ul id="akunList"></ul>
  </div>

  <div id="buatAkunForm">
    <h3>Buat Akun</h3>
    <input type="text" id="username" placeholder="Nama kamu">
    <button onclick="buatAkun()">Buat</button>
  </div>

  <div id="userPanel">
    <h3>Halo, <span id="namaAkun"></span></h3>
    <p>Saldo: <span id="uangAkun" style="color:green;"></span>rb</p>
    <button onclick="tambahUang()">Tambah Uang</button>
    <input id="tambahJumlah" type="number" placeholder="Jumlah">
    <button onclick="ambilUang()">Ambil Uang</button>
    <input id="ambilJumlah" type="number" placeholder="Jumlah">
    <button onclick="resetUang()">Setor (Reset)</button>
    <h4>Riwayat:</h4>
    <ul id="riwayatList"></ul>
  </div>

  <div id="chatBox">
    <h3>Obrolan</h3>
    <div id="chatArea" style="border:1px solid #ccc;height:150px;overflow:auto;"></div>
    <input type="text" id="chatInput" placeholder="Ketik pesan...">
    <button onclick="kirimChat()">Kirim</button>
  </div>

  <script>
    let akun = JSON.parse(localStorage.getItem('akun')) || null;
    let pendaftaran = JSON.parse(localStorage.getItem('pendaftaran')) ?? true;
    let chatLog = JSON.parse(localStorage.getItem('chatLog')) || [];
    let semuaAkun = JSON.parse(localStorage.getItem('semuaAkun')) || {};
    let isAdmin = false;

    const adminBtn = document.getElementById('modeAdminBtn');
    const adminPanel = document.getElementById('adminPanel');
    const adminStatus = document.getElementById('adminStatus');

    function updateUI() {
      document.getElementById('buatAkunForm').style.display = (!akun && pendaftaran) ? 'block' : 'none';
      document.getElementById('userPanel').style.display = akun ? 'block' : 'none';
      document.getElementById('chatBox').style.display = akun ? 'block' : 'none';
      document.getElementById('namaAkun').textContent = akun?.nama || '';
      document.getElementById('uangAkun').textContent = akun?.uang || 0;
      document.getElementById('pendaftaranStatus').textContent = pendaftaran ? 'Dibuka' : 'Ditutup';
      updateRiwayat();
      updateChat();
      updateAkunList();
    }

    function buatAkun() {
      const nama = document.getElementById('username').value.trim();
      if (!nama || semuaAkun[nama]) return alert('Nama sudah digunakan atau kosong!');
      akun = { nama, uang: 0, riwayat: [] };
      semuaAkun[nama] = akun;
      localStorage.setItem('akun', JSON.stringify(akun));
      localStorage.setItem('semuaAkun', JSON.stringify(semuaAkun));
      updateUI();
    }

    function tambahUang() {
      const jml = parseInt(document.getElementById('tambahJumlah').value);
      if (isNaN(jml) || jml <= 0) return;
      akun.uang += jml;
      simpanRiwayat(`Tambah ${jml}rb`);
      simpanAkun();
    }

    function ambilUang() {
      const jml = parseInt(document.getElementById('ambilJumlah').value);
      if (isNaN(jml) || jml <= 0 || jml > akun.uang) return;
      akun.uang -= jml;
      simpanRiwayat(`Ambil ${jml}rb`);
      simpanAkun();
    }

    function resetUang() {
      akun.uang = 0;
      simpanRiwayat(`Reset/Setor Uang`);
      simpanAkun();
    }

    function simpanRiwayat(teks) {
      akun.riwayat.unshift(teks);
      if (akun.riwayat.length > 5) akun.riwayat.pop();
    }

    function simpanAkun() {
      semuaAkun[akun.nama] = akun;
      localStorage.setItem('akun', JSON.stringify(akun));
      localStorage.setItem('semuaAkun', JSON.stringify(semuaAkun));
      updateUI();
    }

    function updateRiwayat() {
      const list = document.getElementById('riwayatList');
      list.innerHTML = '';
      akun?.riwayat.forEach(r => {
        const li = document.createElement('li');
        li.textContent = r;
        list.appendChild(li);
      });
    }

    function kirimChat() {
      const pesan = document.getElementById('chatInput').value.trim();
      if (!pesan) return;
      chatLog.push(`${akun.nama}: ${pesan}`);
      if (chatLog.length > 100) chatLog.shift();
      localStorage.setItem('chatLog', JSON.stringify(chatLog));
      document.getElementById('chatInput').value = '';
      updateChat();
    }

    function updateChat() {
      const area = document.getElementById('chatArea');
      area.innerHTML = chatLog.map(p => `<div>${p}</div>`).join('');
      area.scrollTop = area.scrollHeight;
    }

    function togglePendaftaran() {
      pendaftaran = !pendaftaran;
      localStorage.setItem('pendaftaran', JSON.stringify(pendaftaran));
      updateUI();
    }

    function updateAkunList() {
      if (!isAdmin) return;
      const list = document.getElementById('akunList');
      list.innerHTML = '';
      Object.keys(semuaAkun).forEach(nama => {
        const data = semuaAkun[nama];
        const li = document.createElement('li');
        li.innerHTML = `${nama} - ${data.uang}rb 
          <button onclick="hapusAkun('${nama}')">Hapus</button>
          <button onclick="ubahNama('${nama}')">Ubah Nama</button>`;
        list.appendChild(li);
      });
    }

    function hapusAkun(nama) {
      delete semuaAkun[nama];
      if (akun?.nama === nama) {
        akun = null;
        localStorage.removeItem('akun');
      }
      localStorage.setItem('semuaAkun', JSON.stringify(semuaAkun));
      updateUI();
    }

    function ubahNama(namaLama) {
      const baru = prompt('Nama baru:', namaLama);
      if (!baru || semuaAkun[baru]) return alert('Nama tidak valid atau sudah digunakan!');
      semuaAkun[baru] = semuaAkun[namaLama];
      semuaAkun[baru].nama = baru;
      delete semuaAkun[namaLama];
      if (akun?.nama === namaLama) akun.nama = baru;
      localStorage.setItem('akun', JSON.stringify(akun));
      localStorage.setItem('semuaAkun', JSON.stringify(semuaAkun));
      updateUI();
    }

    adminBtn.onclick = () => {
      if (!isAdmin) {
        const pass = prompt('Masukkan password admin:');
        if (pass === 'RFD1') {
          isAdmin = true;
          adminPanel.style.display = 'block';
          adminBtn.style.background = 'green';
          adminStatus.textContent = '(Aktif)';
          updateAkunList();
        } else {
          alert('Password salah.');
        }
      } else {
        isAdmin = false;
        adminPanel.style.display = 'none';
        adminBtn.style.background = 'red';
        adminStatus.textContent = '(Nonaktif)';
      }
    };

    updateUI();
  </script>
</body>
</html>
