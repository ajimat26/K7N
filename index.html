<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>UangDuty Forum</title>
  <style>
    body { font-family: Arial; background: #fff; padding: 20px; }
    .container { max-width: 800px; margin: auto; }
    .forum-buttons, .forum-controls, .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px 0;
    }
    button {
      padding: 10px 15px;
      font-weight: bold;
      cursor: pointer;
    }
    input[type="text"], input[type="number"] {
      padding: 10px;
      flex-grow: 1;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    .mode-indicator {
      position: fixed;
      top: 10px;
      left: 10px;
      background: black;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="mode-indicator" id="modeIndicator">Mode: Normal</div>
  <div class="container">
    <h1>Forum UangDuty</h1>

    <div class="forum-controls">
      <input type="text" id="forumName" placeholder="Nama Forum (contoh: duty1)" />
      <button onclick="buatForum()">Buat Forum</button>
      <button onclick="aksesStaff()">Akses Staff Safd</button>
      <button id="normalModeBtn" onclick="keluarStaff()" style="display:none;">Mode Normal</button>
    </div>

    <div id="forumButtons" class="forum-buttons"></div>

    <h3 id="forumTitle"></h3>

    <div class="actions" id="aksiSection" style="display:none;">
      <input type="number" id="jumlah" placeholder="Jumlah uang" />
      <button onclick="tambahUang()">Tambah UangDuty</button>
      <button onclick="kurangiUang()">Kurangi UangDuty</button>
      <button onclick="setorUang()">Setor</button>
    </div>

    <table id="riwayatTable" style="display:none;">
      <thead>
        <tr><th>Waktu</th><th>Aksi</th><th>Jumlah</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div id="hapusForumDiv" style="display:none; margin-top:10px;">
      <button onclick="hapusForum()">Hapus Forum Ini</button>
    </div>
  </div>

  <script>
    let forumData = JSON.parse(localStorage.getItem("forumData") || "{}");
    let forumAktif = null;
    let isStaff = false;

    function simpanData() {
      localStorage.setItem("forumData", JSON.stringify(forumData));
      tampilkanForumButtons();
    }

    function buatForum() {
      const nama = document.getElementById("forumName").value.trim();
      if (!nama) return alert("Masukkan nama forum!");
      if (forumData[nama]) return alert("Forum sudah ada!");
      forumData[nama] = [];
      simpanData();
      document.getElementById("forumName").value = "";
    }

    function tampilkanForumButtons() {
      const div = document.getElementById("forumButtons");
      div.innerHTML = "";
      const keys = Object.keys(forumData);
      keys.forEach(nama => {
        if (!isStaff && !localStorage.getItem("forum_" + nama)) return;
        const btn = document.createElement("button");
        btn.textContent = nama;
        btn.onclick = () => bukaForum(nama);
        div.appendChild(btn);
      });
    }

    function bukaForum(nama) {
      forumAktif = nama;
      document.getElementById("forumTitle").innerText = "Forum: " + nama;
      document.getElementById("riwayatTable").style.display = "table";
      const tbody = document.querySelector("#riwayatTable tbody");
      tbody.innerHTML = "";
      forumData[nama].forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.waktu}</td><td>${row.aksi}</td><td>${row.jumlah}</td>`;
        tbody.appendChild(tr);
      });

      if (!isStaff) {
        document.getElementById("aksiSection").style.display = "flex";
        localStorage.setItem("forum_" + nama, "1"); // Tandai forum ini milik pengguna
        document.getElementById("hapusForumDiv").style.display = "none";
      } else {
        document.getElementById("aksiSection").style.display = "none";
        document.getElementById("hapusForumDiv").style.display = "block";
      }
    }

    function tambahUang() {
      updateForum("Tambah");
    }

    function kurangiUang() {
      updateForum("Kurangi");
    }

    function setorUang() {
      updateForum("Setor");
    }

    function updateForum(aksi) {
      if (!forumAktif) return;
      const jumlah = parseInt(document.getElementById("jumlah").value);
      if (isNaN(jumlah)) return alert("Jumlah tidak valid!");
      const waktu = new Date().toLocaleString();
      forumData[forumAktif].push({ waktu, aksi, jumlah });
      simpanData();
      bukaForum(forumAktif);
      document.getElementById("jumlah").value = "";
    }

    function aksesStaff() {
      const pw = prompt("Masukkan password staff:");
      if (pw === "RFD") {
        isStaff = true;
        document.getElementById("modeIndicator").innerText = "Mode: STAFF";
        document.getElementById("normalModeBtn").style.display = "inline-block";
        tampilkanForumButtons();
        alert("Berhasil masuk sebagai staff.");
      } else {
        alert("Password salah.");
      }
    }

    function keluarStaff() {
      isStaff = false;
      document.getElementById("modeIndicator").innerText = "Mode: Normal";
      document.getElementById("normalModeBtn").style.display = "none";
      document.getElementById("hapusForumDiv").style.display = "none";
      tampilkanForumButtons();
    }

    function hapusForum() {
      if (confirm("Yakin ingin menghapus forum ini?")) {
        delete forumData[forumAktif];
        localStorage.removeItem("forum_" + forumAktif);
        forumAktif = null;
        simpanData();
        document.getElementById("forumTitle").innerText = "";
        document.getElementById("riwayatTable").style.display = "none";
        document.getElementById("hapusForumDiv").style.display = "none";
      }
    }

    tampilkanForumButtons();
  </script>
</body>
</html>
