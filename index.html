<!DOCTYPE html>
<html>
<head>
  <title>UANGDUTY SAFD</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; padding: 20px; }
    #chat { border: 1px solid #555; padding: 10px; max-width: 600px; height: 300px; overflow-y: scroll; background: #222; margin-bottom: 10px; }
    #input { width: 80%; padding: 5px; }
    #send { padding: 5px 10px; }
  </style>
</head>
<body>
  <h1>UANGDUTY SAFD - Forum Pekerja Uang & Chat</h1>

  <div id="container" style="display:none;">
    <div id="chat"></div>
    <input type="text" id="input" placeholder="Ketik pesan...">
    <button id="send">Kirim</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    // GANTI DENGAN FIREBASE KONFIGURASI PUNYAMU
    var firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let userId = localStorage.getItem("userId");
    let fullName = "";
    let isAdmin = false;

    function initAkun() {
      if (!userId) return daftarAkunBaru();
      db.ref("pengguna/" + userId).once("value", snap => {
        if (snap.exists()) {
          fullName = snap.val().nama;
          isAdmin = snap.val().isAdmin;
          mulaiApp();
        } else {
          alert("Akun Anda telah dihapus admin. Silakan daftar ulang.");
          localStorage.removeItem("userId");
          daftarAkunBaru();
        }
      });
    }

    function daftarAkunBaru() {
      const nama = prompt("Masukkan nama Anda:");
      if (!nama) return alert("Nama tidak boleh kosong.");
      const ref = db.ref("pengguna").push();
      userId = ref.key;
      fullName = nama;
      isAdmin = false;
      ref.set({
        nama: nama,
        waktuDaftar: new Date().toISOString(),
        isAdmin: false
      });
      localStorage.setItem("userId", userId);
      mulaiApp();
    }

    function mulaiApp() {
      document.getElementById("container").style.display = "block";
      loadChat();
    }

    document.getElementById("send").onclick = () => {
      const msg = document.getElementById("input").value.trim();
      if (!msg) return;
      db.ref("chat").push({
        nama: fullName,
        pesan: msg,
        isAdmin: isAdmin,
        waktu: Date.now()
      });
      document.getElementById("input").value = "";
    };

    function loadChat() {
      db.ref("chat").limitToLast(100).on("child_added", snap => {
        const data = snap.val();
        const tag = data.isAdmin ? "(ADMIN)" : "";
        const line = `<div><strong>${tag} ${data.nama}:</strong> ${data.pesan}</div>`;
        document.getElementById("chat").innerHTML += line;
        document.getElementById("chat").scrollTop = 9999;
      });
    }

    initAkun();
  </script>
</body>
</html>
