<!DOCTYPE html>
<html>
<head>
  <title>Chat Realtime Firebase Realtime DB</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: auto; padding: 20px; }
    #login { margin-bottom: 20px; }
    #chat { display: none; border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; }
    #messages { list-style: none; padding: 0; }
    #messages li { margin: 5px 0; }
    .me { text-align: right; color: green; }
    .other { text-align: left; color: blue; }
  </style>
</head>
<body>

<h2>Chat Realtime Firebase Realtime Database</h2>

<div id="login">
  <input type="text" id="userId" placeholder="Masukkan ID (misal: user123)" />
  <input type="text" id="chatWith" placeholder="Chat dengan ID (misal: user456)" />
  <button id="btnLogin">Login & Mulai Chat</button>
</div>

<div id="chat">
  <ul id="messages"></ul>
  <input type="text" id="inputMsg" placeholder="Ketik pesan..." style="width:80%" />
  <button id="btnSend">Kirim</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Config Firebase Realtime Database kamu
  const firebaseConfig = {
    apiKey: "AIzaSyA3-34rf9VZUIrAIR6z4BJtQm_MClqXm-Q",
    authDomain: "uangduty.firebaseapp.com",
    databaseURL: "https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "uangduty",
    storageBucket: "uangduty.firebasestorage.app",
    messagingSenderId: "598905752132",
    appId: "1:598905752132:web:7be400c23de21665044a11",
    measurementId: "G-TJL9K6YDL9"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUser = null;
  let chatWithUser = null;
  let chatId = null;

  document.getElementById('btnLogin').onclick = () => {
    const userId = document.getElementById('userId').value.trim();
    const chatWithId = document.getElementById('chatWith').value.trim();
    if (!userId || !chatWithId) {
      alert("Isi kedua ID dulu ya!");
      return;
    }
    currentUser = userId;
    chatWithUser = chatWithId;
    chatId = userId < chatWithId ? userId + '_' + chatWithId : chatWithId + '_' + userId;

    document.getElementById('login').style.display = 'none';
    document.getElementById('chat').style.display = 'block';

    loadMessages();
  };

  function loadMessages() {
    const messagesRef = db.ref('chats/' + chatId);
    messagesRef.off();
    messagesRef.on('value', snapshot => {
      const messagesList = document.getElementById('messages');
      messagesList.innerHTML = "";
      const data = snapshot.val();
      if (!data) return;
      Object.entries(data).forEach(([key, msg]) => {
        const li = document.createElement('li');
        li.textContent = msg.from + ": " + msg.text;
        li.className = msg.from === currentUser ? 'me' : 'other';
        messagesList.appendChild(li);
      });
      messagesList.scrollTop = messagesList.scrollHeight;
    });
  }

  document.getElementById('btnSend').onclick = sendMessage;
  document.getElementById('inputMsg').addEventListener('keypress', e => {
    if (e.key === 'Enter') sendMessage();
  });

  function sendMessage() {
    const input = document.getElementById('inputMsg');
    const text = input.value.trim();
    if (!text) return;

    const messagesRef = db.ref('chats/' + chatId);
    const newMsgRef = messagesRef.push();
    newMsgRef.set({
      from: currentUser,
      to: chatWithUser,
      text: text,
      createdAt: Date.now()
    });

    input.value = '';
  }
</script>

</body>
</html>
