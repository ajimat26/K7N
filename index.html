<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>SAFD MONEY</title>
  <style>
    body {
      background-color: black;
      color: lime;
      font-family: monospace;
      padding: 20px;
    }
    input, button, select {
      background-color: #111;
      color: lime;
      border: 1px solid lime;
      padding: 5px;
      margin: 5px 0;
    }
    .hidden { display: none; }
    .chat-box {
      border: 1px solid lime;
      padding: 10px;
      height: 150px;
      overflow-y: auto;
      margin-top: 10px;
    }
    .money { color: lightgreen; }
    .admin-panel, .forum-panel, .create-panel {
      border: 1px solid lime;
      padding: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>SAFD MONEY</h1>

<div id="createAccountPanel" class="create-panel">
  <h3>Buat Akun</h3>
  <input type="text" id="newName" placeholder="Nama Anda">
  <input type="number" id="initialMoney" placeholder="Uang Awal">
  <button onclick="createAccount()">Buat</button>
</div>

<div id="adminLoginPanel">
  <h3>Login Admin</h3>
  <input type="password" id="adminPass" placeholder="Password">
  <button onclick="adminLogin()">Login</button>
</div>

<div id="adminPanel" class="admin-panel hidden">
  <h3>Panel Admin</h3>
  <p>Nama Admin: <span id="adminName"></span></p>
  <h4>Data Anggota</h4>
  <div id="userList"></div>
  <h4>Top Tier (3 Teratas)</h4>
  <div id="topTier"></div>
</div>

<div id="forumPanel" class="forum-panel hidden">
  <h3>Forum SAFD MONEY</h3>
  <p>Selamat datang, <span id="userNameDisplay"></span>!</p>
  <p>Total Uang: <span id="userMoneyDisplay" class="money"></span></p>
  <div class="chat-box" id="chatBox"></div>
  <input type="text" id="chatInput" placeholder="Ketik pesan...">
  <button onclick="sendChat()">Kirim</button>
</div>

<script>
  let akun = null;
  let isAdmin = false;
  let adminName = "";
  let users = JSON.parse(localStorage.getItem("users") || "[]");
  let chats = JSON.parse(localStorage.getItem("chats") || "[]");

  function formatMoney(val) {
    return 'Rp ' + Number(val).toLocaleString('id-ID');
  }

  function createAccount() {
    const name = document.getElementById('newName').value.trim();
    const money = parseInt(document.getElementById('initialMoney').value);
    if (!name || isNaN(money)) return alert("Lengkapi nama dan uang!");

    akun = { name, money };
    users.push(akun);
    localStorage.setItem("users", JSON.stringify(users));
    showForum();
    document.getElementById("createAccountPanel").classList.add("hidden");
  }

  function showForum() {
    isAdmin = false;
    document.getElementById("userNameDisplay").innerText = akun.name;
    document.getElementById("userMoneyDisplay").innerText = formatMoney(akun.money);
    document.getElementById("forumPanel").classList.remove("hidden");
    loadChats();
  }

  function sendChat() {
    const input = document.getElementById("chatInput");
    if (!input.value.trim()) return;
    const message = {
      name: isAdmin ? adminName + " (Admin)" : akun?.name,
      text: input.value
    };
    chats.push(message);
    localStorage.setItem("chats", JSON.stringify(chats));
    input.value = '';
    loadChats();
  }

  function loadChats() {
    const box = document.getElementById("chatBox");
    box.innerHTML = chats.map(c => `<div><b>${c.name}:</b> ${c.text}</div>`).join('');
    box.scrollTop = box.scrollHeight;
  }

  function adminLogin() {
    const pass = document.getElementById("adminPass").value;
    if (pass === "RFD1") {
      isAdmin = true;
      adminName = prompt("Masukkan nama admin:");
      document.getElementById("adminPanel").classList.remove("hidden");
      document.getElementById("adminLoginPanel").classList.add("hidden");
      document.getElementById("forumPanel").classList.remove("hidden");
      document.getElementById("userNameDisplay").innerText = adminName + " (Admin)";
      document.getElementById("userMoneyDisplay").innerText = formatMoney(0);
      loadUserList();
      loadChats();
      showTopTier();
    } else {
      alert("Password salah!");
    }
  }

  function loadUserList() {
    const list = document.getElementById("userList");
    list.innerHTML = users.map((u, i) => `
      <div>
        <b>${u.name}</b> - ${formatMoney(u.money)}
        <button onclick="editUser(${i})">Edit</button>
        <button onclick="deleteUser(${i})">Hapus</button>
      </div>
    `).join('');
  }

  function editUser(i) {
    const newName = prompt("Nama baru untuk " + users[i].name);
    if (newName) {
      users[i].name = newName;
      localStorage.setItem("users", JSON.stringify(users));
      loadUserList();
      showTopTier();
    }
  }

  function deleteUser(i) {
    if (confirm("Yakin ingin menghapus akun ini?")) {
      users.splice(i, 1);
      localStorage.setItem("users", JSON.stringify(users));
      loadUserList();
      showTopTier();
      if (akun && i === users.findIndex(u => u.name === akun.name)) {
        akun = null;
        document.getElementById("forumPanel").classList.add("hidden");
        document.getElementById("createAccountPanel").classList.remove("hidden");
      }
    }
  }

  function showTopTier() {
    const top = [...users].sort((a, b) => b.money - a.money).slice(0, 3);
    const el = document.getElementById("topTier");
    el.innerHTML = top.map((u, i) => `<div>${i + 1}. ${u.name} - ${formatMoney(u.money)}</div>`).join('');
  }

  // Cek apakah ada akun aktif
  window.onload = () => {
    if (users.length === 0) {
      document.getElementById("createAccountPanel").classList.remove("hidden");
    }
  };
</script>

</body>
</html>
