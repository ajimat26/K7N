<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>SAFD MONEY Forum</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin:0; padding:20px; }
  .panel { background:#fff; padding:20px; border-radius:8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
  .hidden { display:none; }
  input, button { display:block; margin:10px 0; padding:10px; width: 100%; max-width:300px; box-sizing:border-box; }
  .chat-box { border:1px solid #ccc; padding:10px; height:150px; overflow-y:auto; background:#fafafa; }
  .green { color:green; font-weight:bold; }
  ul { padding-left: 20px; }
  button.small { width: auto; padding: 5px 10px; margin-left: 5px; }
</style>
</head>
<body>

<!-- Panel buat akun -->
<div class="panel" id="buatAkunPanel">
  <h2>Buat Akun SAFD</h2>
  <input type="text" id="inputNamaAkun" placeholder="Nama Akun" />
  <input type="number" id="inputSaldoAwal" placeholder="Saldo Awal" />
  <button id="btnBuatAkun">Buat Akun</button>
</div>

<!-- Panel forum dan pengelolaan uang user biasa -->
<div class="panel hidden" id="forumPanel">
  <h2>Forum SAFD MONEY</h2>
  <p>Selamat datang, <span id="namaUserDisplay"></span>!</p>
  <p>Saldo: <span id="saldoUserDisplay" class="green"></span></p>

  <input type="text" id="inputChat" placeholder="Tulis pesan..." />
  <button id="btnKirimChat">Kirim</button>
  <div class="chat-box" id="chatBox"></div>

  <div id="panelUangUser">
    <h3>Kelola Uang</h3>
    <input type="number" id="inputJumlahUang" placeholder="Jumlah" />
    <button id="btnTambahUang">Tambah</button>
    <button id="btnAmbilUang">Ambil</button>
  </div>

  <button id="btnMasukAdmin">Masuk Admin</button>
</div>

<!-- Panel login admin -->
<div class="panel hidden" id="loginAdminPanel">
  <h2>Login Admin</h2>
  <input type="password" id="inputPassAdmin" placeholder="Password Admin" />
  <button id="btnLoginAdmin">Login</button>
</div>

<!-- Panel admin -->
<div class="panel hidden" id="adminPanel">
  <h2>Panel Admin</h2>
  <p>Nama Admin: <span id="namaAdminDisplay"></span></p>
  <input type="text" id="inputNamaAdminBaru" placeholder="Ubah Nama Admin" />
  <button id="btnUbahNamaAdmin">Ubah Nama</button>
  <button id="btnKeluarAdmin">Keluar Admin</button>

  <h3>Daftar Akun</h3>
  <ul id="daftarAkunList"></ul>
</div>

<!-- Panel Top Tier Investor -->
<div class="panel" id="topTierPanel">
  <h2>Top Tier Investor</h2>
  <ol id="topTierList"></ol>
</div>

<script>
(() => {
  // Constants & state
  const STORAGE_KEY_AKUN_LIST = "SAFD_akunList";
  const STORAGE_KEY_LOGIN = "SAFD_loginAkun";
  const STORAGE_KEY_ADMIN_NAME = "SAFD_adminName";

  const PASSWORD_ADMIN = "RFD1";

  // Elements
  const buatAkunPanel = document.getElementById("buatAkunPanel");
  const forumPanel = document.getElementById("forumPanel");
  const loginAdminPanel = document.getElementById("loginAdminPanel");
  const adminPanel = document.getElementById("adminPanel");
  const topTierListEl = document.getElementById("topTierList");

  const inputNamaAkun = document.getElementById("inputNamaAkun");
  const inputSaldoAwal = document.getElementById("inputSaldoAwal");
  const btnBuatAkun = document.getElementById("btnBuatAkun");

  const namaUserDisplay = document.getElementById("namaUserDisplay");
  const saldoUserDisplay = document.getElementById("saldoUserDisplay");

  const inputChat = document.getElementById("inputChat");
  const btnKirimChat = document.getElementById("btnKirimChat");
  const chatBox = document.getElementById("chatBox");

  const inputJumlahUang = document.getElementById("inputJumlahUang");
  const btnTambahUang = document.getElementById("btnTambahUang");
  const btnAmbilUang = document.getElementById("btnAmbilUang");

  const btnMasukAdmin = document.getElementById("btnMasukAdmin");

  const inputPassAdmin = document.getElementById("inputPassAdmin");
  const btnLoginAdmin = document.getElementById("btnLoginAdmin");

  const namaAdminDisplay = document.getElementById("namaAdminDisplay");
  const inputNamaAdminBaru = document.getElementById("inputNamaAdminBaru");
  const btnUbahNamaAdmin = document.getElementById("btnUbahNamaAdmin");
  const btnKeluarAdmin = document.getElementById("btnKeluarAdmin");

  const daftarAkunList = document.getElementById("daftarAkunList");

  // Variables
  let akunList = [];
  let currentUser = null; // {nama, uang}
  let adminName = "Admin SAFD";

  // ======= Helper functions =======
  function simpanData() {
    localStorage.setItem(STORAGE_KEY_AKUN_LIST, JSON.stringify(akunList));
  }

  function loadData() {
    const saved = localStorage.getItem(STORAGE_KEY_AKUN_LIST);
    if (saved) {
      try {
        akunList = JSON.parse(saved);
      } catch {
        akunList = [];
      }
    }
    const savedAdminName = localStorage.getItem(STORAGE_KEY_ADMIN_NAME);
    if (savedAdminName) adminName = savedAdminName;
  }

  function simpanLogin(nama) {
    localStorage.setItem(STORAGE_KEY_LOGIN, nama);
  }

  function hapusLogin() {
    localStorage.removeItem(STORAGE_KEY_LOGIN);
  }

  function tampilkanTopTier() {
    const sorted = [...akunList].sort((a,b) => b.uang - a.uang).slice(0,3);
    topTierListEl.innerHTML = "";
    sorted.forEach(a => {
      const li = document.createElement("li");
      li.textContent = `${a.nama} - Rp ${a.uang.toLocaleString()}`;
      topTierListEl.appendChild(li);
    });
  }

  function updateSaldoDisplay() {
    saldoUserDisplay.textContent = `Rp ${currentUser.uang.toLocaleString()}`;
  }

  function tampilkanDaftarAkun() {
    daftarAkunList.innerHTML = "";
    akunList.forEach((akun, index) => {
      const li = document.createElement("li");
      li.innerHTML = `${akun.nama} - Rp ${akun.uang.toLocaleString()} 
        <button class="small" data-index="${index}" data-action="gantiNama">Ganti Nama</button>
        <button class="small" data-index="${index}" data-action="hapusAkun">Hapus</button>`;
      daftarAkunList.appendChild(li);
    });
  }

  function showPanel(panel) {
    // Hide all
    buatAkunPanel.classList.add("hidden");
    forumPanel.classList.add("hidden");
    loginAdminPanel.classList.add("hidden");
    adminPanel.classList.add("hidden");

    // Show requested panel
    panel.classList.remove("hidden");
  }

  // ======= Actions =======
  // Buat akun baru
  btnBuatAkun.onclick = () => {
    const nama = inputNamaAkun.value.trim();
    const saldoAwal = parseInt(inputSaldoAwal.value);
    if (!nama) return alert("Masukkan nama akun!");
    if (isNaN(saldoAwal) || saldoAwal < 0) return alert("Masukkan saldo awal valid!");
    if (akunList.find(a => a.nama.toLowerCase() === nama.toLowerCase())) {
      return alert("Nama akun sudah ada!");
    }
    const newAkun = { nama, uang: saldoAwal };
    akunList.push(newAkun);
    simpanData();

    currentUser = newAkun;
    simpanLogin(currentUser.nama);
    inputNamaAkun.value = "";
    inputSaldoAwal.value = "";
    masukForum();
  };

  // Masuk ke forum user biasa
  function masukForum() {
    if (!currentUser) return;
    namaUserDisplay.textContent = currentUser.nama;
    updateSaldoDisplay();
    chatBox.innerHTML = "";
    // Jika admin login, sembunyikan panel uang user biasa
    document.getElementById("panelUangUser").style.display = (currentUser.nama === adminName) ? "none" : "block";
    showPanel(forumPanel);
    tampilkanTopTier();
  }

  // Kirim chat
  btnKirimChat.onclick = () => {
    const pesan = inputChat.value.trim();
    if (!pesan) return;
    const p = document.createElement("p");
    p.innerHTML = `<b>${currentUser.nama}:</b> ${pesan}`;
    chatBox.appendChild(p);
    chatBox.scrollTop = chatBox.scrollHeight;
    inputChat.value = "";
  };

  // Tambah uang
  btnTambahUang.onclick = () => {
    if (!currentUser || currentUser.nama === adminName) return alert("Panel uang hanya untuk user biasa.");
    const jumlah = parseInt(inputJumlahUang.value);
    if (isNaN(jumlah) || jumlah <= 0) return alert("Masukkan jumlah uang valid > 0.");
    currentUser.uang += jumlah;
    simpanSaldoUser();
    updateSaldoDisplay();
    tampilkanTopTier();
    inputJumlahUang.value = "";
  };

  // Ambil uang
  btnAmbilUang.onclick = () => {
    if (!currentUser || currentUser.nama === adminName) return alert("Panel uang hanya untuk user biasa.");
    const jumlah = parseInt(inputJumlahUang.value);
    if (isNaN(jumlah) || jumlah <= 0) return alert("Masukkan jumlah uang valid > 0.");
    if (jumlah > currentUser.uang) return alert("Saldo tidak
