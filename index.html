<!DOCTYPE html><html>
<head>
  <title>Forum UangDuty</title>
  <style>
    body { font-family: Arial, sans-serif; }
    #loading { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255,255,255,0.8); z-index: 9999; text-align: center; padding-top: 200px; font-size: 24px; }
    .forum-box { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
    #mode-info { position: fixed; top: 10px; left: 10px; font-weight: bold; }
  </style>
</head>
<body><div id="loading">Loading...</div>
<div id="mode-info"></div><h2>Forum UangDuty</h2>
<button onclick="createForum()">Buat Forum</button>
<button onclick="toggleStaffMode()">Mode Staff</button>
<div id="forum-container"></div><script>
const db = {} // simulasi database sementara
let isStaffMode = false;
let staffName = localStorage.getItem("staffName") || "";
let currentUser = localStorage.getItem("forumUser") || null;

if (!currentUser) {
  const forumName = prompt("Masukkan nama forum (otomatis jadi akun):");
  localStorage.setItem("forumUser", forumName);
  currentUser = forumName;
}

function showLoading() { document.getElementById("loading").style.display = "block"; }
function hideLoading() { document.getElementById("loading").style.display = "none"; }

function toggleStaffMode() {
  const pass = prompt("Masukkan password staff:");
  if (pass === "RFD") {
    isStaffMode = true;
    staffName = prompt("Masukkan nama staff:");
    localStorage.setItem("staffName", staffName);
    alert("Mode staff diaktifkan sebagai " + staffName);
    updateModeInfo();
    renderForums();
  }
}

function updateModeInfo() {
  document.getElementById("mode-info").innerText = isStaffMode ? `Mode Staff (${staffName})` : `Mode Normal (${currentUser})`;
}

function createForum() {
  const title = prompt("Judul forum:");
  const timestamp = new Date().toLocaleString();
  db[title] = {
    owner: currentUser,
    waktu: timestamp,
    uang: 0,
    history: []
  };
  renderForums();
}

function renderForums() {
  const container = document.getElementById("forum-container");
  container.innerHTML = "";
  for (const title in db) {
    const forum = db[title];
    if (forum.owner === currentUser || isStaffMode) {
      const box = document.createElement("div");
      box.className = "forum-box";
      box.innerHTML = `<b>${title}</b> oleh ${forum.owner}<br>Waktu: ${forum.waktu}<br>UangDuty: ${forum.uang}<br>`;

      if (isStaffMode && forum.owner !== currentUser) {
        forum.history.push(`Staff ${staffName} melihat forum pada ${new Date().toLocaleString()}`);
        box.innerHTML += `<i>Forum dimiliki oleh orang lain</i><br>`;
      }

      if (isStaffMode) {
        box.innerHTML += `<button onclick="editForum('${title}')">Ubah Nama</button>
                          <button onclick="deleteForum('${title}')">Hapus</button>`;
      }

      if (forum.owner === currentUser || isStaffMode) {
        box.innerHTML += `<br>
          <button onclick="tambahUang('${title}')">Tambah UangDuty</button>
          <button onclick="ambilUang('${title}')">Ambil UangDuty</button>
          <button onclick="setorUang('${title}')">Setor UangDuty</button>`;
      }

      if (forum.history.length > 0 && forum.owner === currentUser) {
        box.innerHTML += `<br><b>Riwayat:</b><br>` + forum.history.join("<br>");
      }

      container.appendChild(box);
    }
  }
  updateModeInfo();
}

function editForum(oldTitle) {
  const newTitle = prompt("Nama forum baru:");
  db[newTitle] = { ...db[oldTitle] };
  delete db[oldTitle];
  renderForums();
}

function deleteForum(title) {
  if (confirm("Yakin ingin menghapus forum?")) {
    delete db[title];
    renderForums();
  }
}

function tambahUang(title) {
  db[title].uang += 100;
  renderForums();
}

function ambilUang(title) {
  db[title].uang -= 50;
  renderForums();
}

function setorUang(title) {
  db[title].uang += 200;
  renderForums();
}

// Inisialisasi tampilan
updateModeInfo();
renderForums();
</script></body>
</html>
