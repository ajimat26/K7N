<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Random Box Game & Admin Panel</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
      color: #fff;
      user-select: none;
      text-align: center;
    }
    #points, #message, #adminPanel, #notification {
      margin-top: 20px;
      font-weight: bold;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      font-weight: bold;
      margin: 10px;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background-color: #2196f3;
      color: white;
      transition: background-color 0.3s ease;
    }
    button:hover:not(:disabled) {
      background-color: #0b7dda;
    }
    button:disabled {
      background-color: #777;
      cursor: not-allowed;
    }
    #exchange-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      max-width: 350px;
      margin: 20px auto;
      color: #fff;
    }
    input, select {
      width: 100%;
      margin: 5px 0;
      padding: 8px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
    }
    #adminLogin, #adminPanel, #messagesPanel {
      max-width: 400px;
      margin: 20px auto;
      background: rgba(0,0,0,0.3);
      padding: 15px;
      border-radius: 10px;
      color: #fff;
      text-align: left;
    }
    #withdrawList, #messagesList {
      max-height: 150px;
      overflow-y: auto;
      padding-left: 20px;
    }
    #messagesPanel {
      display: none;
    }
    #notification {
      color: yellow;
      font-size: 16px;
      min-height: 24px;
      margin-top: 10px;
      min-height: 30px;
    }
    #exchangeMessage {
      margin-top: 10px;
      min-height: 24px;
      font-weight: bold;
      color: #ffcc00;
    }
  </style>
</head>
<body>

  <div id="points">Poin: 0</div>
  <div id="notification"></div>

  <button id="openBoxBtn">Buka Kotak</button>

  <div id="message"></div>

  <div id="exchange-section">
    <h2>Tukar Poin</h2>
    <select id="amount">
      <option value="500">50.000 IC - 500 Poin</option>
      <option value="1000">100.000 IC - 1000 Poin</option>
      <option value="2500">250.000 IC - 2500 Poin</option>
    </select>
    <input type="text" id="fullname" placeholder="Nama lengkap" />
    <input type="text" id="account" placeholder="Nomor rekening" />
    <button id="withdrawBtn">Ajukan Penarikan</button>
    <div id="exchangeMessage"></div>
  </div>

  <button id="toggleMessagesBtn">Lihat Pesan & Riwayat</button>

  <div id="messagesPanel">
    <h3>Riwayat Pesan</h3>
    <ul id="messagesList"></ul>
    <button id="clearMessagesBtn">Hapus Pesan</button>
  </div>

  <div id="adminLogin">
    <h3>Login Admin</h3>
    <input type="text" id="adminUser" placeholder="Username" />
    <input type="password" id="adminPass" placeholder="Password" />
    <button id="loginAdminBtn">Login</button>
  </div>

  <div id="adminPanel" style="display:none;">
    <h2>Admin Panel</h2>
    <div>Total Poin: <span id="totalPoints">0</span></div>
    <h3>Riwayat Penarikan:</h3>
    <ul id="withdrawList"></ul>
    <button id="logoutAdminBtn">Logout</button>
  </div>

<script>
  // Data awal
  let points = parseInt(localStorage.getItem("points")) || 0;
  let messages = JSON.parse(localStorage.getItem("messages") || "[]");
  let withdraws = JSON.parse(localStorage.getItem("withdraws") || "[]");
  let doubleNext = false;

  const notification = document.getElementById("notification");
  const openBoxBtn = document.getElementById("openBoxBtn");
  const withdrawBtn = document.getElementById("withdrawBtn");
  const toggleMessagesBtn = document.getElementById("toggleMessagesBtn");
  const clearMessagesBtn = document.getElementById("clearMessagesBtn");
  const loginAdminBtn = document.getElementById("loginAdminBtn");
  const logoutAdminBtn = document.getElementById("logoutAdminBtn");

  const rewards = [
    { name: "Zonk", points: 0 },
    { name: "+10 Poin", points: 10 },
    { name: "+25 Poin", points: 25 },
    { name: "+50 Poin", points: 50 },
    { name: "2x Poin Berikutnya", points: -1 } // Special
  ];

  // Update tampilan poin
  function updatePointsDisplay() {
    document.getElementById("points").textContent = "Poin: " + points;
    localStorage.setItem("points", points);
  }

  // Tambah pesan
  function addMessage(text) {
    messages.push(text);
    if (messages.length > 50) messages.shift(); // batasi max 50 pesan
    localStorage.setItem("messages", JSON.stringify(messages));
    if(document.getElementById("messagesPanel").style.display === "block") {
      renderMessages();
    }
  }

  // Render daftar pesan
  function renderMessages() {
    const list = document.getElementById("messagesList");
    list.innerHTML = "";
    messages.forEach((msg) => {
      const li = document.createElement("li");
      li.textContent = msg;
      list.appendChild(li);
    });
  }

  // Toggle panel pesan
  function toggleMessagesPanel() {
    const panel = document.getElementById("messagesPanel");
    if(panel.style.display === "block") {
      panel.style.display = "none";
    } else {
      panel.style.display = "block";
      renderMessages();
    }
  }

  // Hapus semua pesan
  function clearMessages() {
    if(confirm("Yakin ingin menghapus semua pesan?")) {
      messages = [];
      localStorage.setItem("messages", JSON.stringify(messages));
      renderMessages();
    }
  }

  // Fungsi buka kotak
  function openBox() {
    openBoxBtn.disabled = true;
    notification.textContent = "Membuka kotak...";
    setTimeout(() => {
      let rewardIndex = Math.floor(Math.random() * rewards.length);
      let reward = rewards[rewardIndex];
      let earned = 0;

      if(reward.points === -1) { // bonus 2x poin
        doubleNext = true;
        notification.textContent = "Selanjutnya poinmu akan dikalikan 2!";
        addMessage("Mendapatkan bonus 2x poin berikutnya!");
      } else {
        earned = doubleNext ? reward.points * 2 : reward.points;
        doubleNext = false;
        points += earned;
        notification.textContent = `Kamu mendapatkan ${earned} poin (${reward.name})!`;
        addMessage(`Mendapatkan hadiah: ${reward.name} (${earned} poin)`);
        updatePointsDisplay();
      }

      openBoxBtn.disabled = false;
    }, 3000);
  }

  // Submit penarikan
  function submitWithdraw() {
    const amount = parseInt(document.getElementById("amount").value);
    const name = document.getElementById("fullname").value.trim();
    const acc = document.getElementById("account").value.trim();
    const exchangeMsg = document.getElementById("exchangeMessage");

    exchangeMsg.textContent = "";

    if (!name) {
      alert("Harap isi nama lengkap.");
      return;
    }
    if (!acc) {
      alert("Harap isi nomor rekening.");
      return;
    }
    if (isNaN(amount) || amount <= 0) {
      alert("Jumlah poin tidak valid.");
      return;
    }
    if (points < amount) {
      exchangeMsg.textContent = "Poin tidak cukup!";
      return;
    }

    points -= amount;
    updatePointsDisplay();
    exchangeMsg.style.color = "#00ff00";
    exchangeMsg.textContent = "Permintaan penarikan diajukan!";
    addMessage(`Penarikan diajukan: ${name} - ${acc} - ${amount} poin`);

    withdraws.push({ name, acc, amount });
    localStorage.setItem("withdraws", JSON.stringify(withdraws));
  }

  // Login admin
  function loginAdmin() {
    const user = document.getElementById("adminUser").value.trim();
    const pass = document.getElementById("adminPass").value.trim();
    if (user === "admin" && pass === "admin123") {
      document.getElementById("adminPanel").style.display = "block";
      document.getElementById("adminLogin").style.display = "none";
      showAdminData();
    } else {
      alert("Login gagal!");
    }
  }

  // Logout admin
  function logoutAdmin() {
    document.getElementById("adminPanel").style.display = "none";
    document.getElementById("adminLogin").style.display = "block";
  }

  // Tampilkan data admin
  function showAdminData() {
    document.getElementById("totalPoints").textContent = points;
    const list = document.getElementById("withdrawList");
    list.innerHTML = "";
    withdraws.forEach((w) => {
      const li = document.createElement("li");
      li.textContent = `${w.name} - ${w.acc} - ${w.amount} poin`;
      list.appendChild(li);
    });
  }

  // Event listener
  openBoxBtn.addEventListener("click", openBox);
  withdrawBtn.addEventListener("click", submitWithdraw);
  toggleMessagesBtn.addEventListener("click", toggleMessagesPanel);
  clearMessagesBtn.addEventListener("click", clearMessages);
  loginAdminBtn.addEventListener("click", loginAdmin);
  logoutAdminBtn.addEventListener("click", logoutAdmin);

  // Inisialisasi awal
  updatePointsDisplay();

</script>

</body>
</html>
