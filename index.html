<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>SAFD MONEY</title>
  <style>
    body {
      font-family: Arial;
      background: #f9f9f9;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h2 {
      color: #003366;
    }
    .panel, .nav {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .nav button {
      margin-right: 10px;
      padding: 8px 15px;
    }
    .money {
      color: green;
      font-weight: bold;
    }
    #chat-box {
      max-height: 200px;
      overflow-y: auto;
      background: #eef;
      padding: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="nav" id="navbar"></div>
  <div id="main"></div>

<script>
let akun = JSON.parse(localStorage.getItem("akun"));
let isAdmin = JSON.parse(localStorage.getItem("admin")) || false;
let chatLog = JSON.parse(localStorage.getItem("chatLog")) || [];
let currentPage = localStorage.getItem("page") || "home";

function simpanSemua() {
  localStorage.setItem("akun", JSON.stringify(akun));
  localStorage.setItem("admin", JSON.stringify(isAdmin));
  localStorage.setItem("chatLog", JSON.stringify(chatLog));
}

function formatRupiah(nom) {
  return "Rp " + nom.toLocaleString("id-ID");
}

function buatAkun() {
  const nama = prompt("Masukkan nama:");
  if (!nama) return;
  akun = { nama, uang: 0 };
  simpanSemua();
  render();
}

function hapusAkun() {
  if (confirm("Yakin hapus akun ini?")) {
    localStorage.removeItem("akun");
    render();
  }
}

function loginAdmin() {
  const pass = prompt("Masukkan password admin:");
  if (pass === "RFD1") {
    isAdmin = true;
    simpanSemua();
    render();
  } else {
    alert("Password salah.");
  }
}

function logoutAdmin() {
  isAdmin = false;
  simpanSemua();
  render();
}

function ubahUang(nom) {
  akun.uang = Math.max(0, akun.uang + nom);
  simpanSemua();
  render();
}

function setorUang() {
  akun.uang += 10000;
  simpanSemua();
  render();
}

function kirimChat() {
  const teks = prompt("Tulis pesan:");
  if (!teks) return;
  chatLog.push({ nama: akun.nama, teks });
  if (chatLog.length > 5) chatLog.shift();
  simpanSemua();
  render();
}

function getTop3() {
  let all = JSON.parse(localStorage.getItem("allData")) || {};
  all[akun.nama] = akun;
  localStorage.setItem("allData", JSON.stringify(all));
  return Object.values(all)
    .sort((a, b) => b.uang - a.uang)
    .slice(0, 3)
    .map((x, i) => `${i+1}. ${x.nama} - <span class="money">${formatRupiah(x.uang)}</span>`)
    .join("<br>");
}

function updateAllData() {
  let all = JSON.parse(localStorage.getItem("allData")) || {};
  all[akun.nama] = akun;
  localStorage.setItem("allData", JSON.stringify(all));
}

function gantiNamaUser(namaLama) {
  let baru = prompt("Nama baru:", namaLama);
  if (!baru) return;
  let all = JSON.parse(localStorage.getItem("allData"));
  all[baru] = all[namaLama];
  all[baru].nama = baru;
  delete all[namaLama];
  if (akun.nama === namaLama) akun.nama = baru;
  localStorage.setItem("allData", JSON.stringify(all));
  simpanSemua();
  render();
}

function hapusUser(nama) {
  let all = JSON.parse(localStorage.getItem("allData"));
  delete all[nama];
  localStorage.setItem("allData", JSON.stringify(all));
  if (akun.nama === nama) {
    localStorage.removeItem("akun");
    render();
  } else {
    render();
  }
}

function getAdminPanel() {
  let all = JSON.parse(localStorage.getItem("allData")) || {};
  return Object.keys(all).map(nama => `
    <div style="margin-bottom:5px;">
      <b>${nama}</b> - ${formatRupiah(all[nama].uang)}
      <button onclick="hapusUser('${nama}')">Hapus</button>
      <button onclick="gantiNamaUser('${nama}')">Edit Nama</button>
    </div>
  `).join('');
}

function setPage(page) {
  currentPage = page;
  localStorage.setItem("page", page);
  render();
}

function renderNav() {
  document.getElementById("navbar").innerHTML = `
    <button onclick="setPage('home')">Beranda</button>
    <button onclick="setPage('chat')">Chat</button>
    <button onclick="setPage('top')">Top Tier</button>
  `;
}

function render() {
  if (!akun) return buatAkun();
  updateAllData();
  renderNav();
  let html = "";

  if (currentPage === "home") {
    html = `
      <div class="panel">
        <h2>Halo, ${akun.nama}</h2>
        <p>Saldo: <span class="money">${formatRupiah(akun.uang)}</span></p>
        <button onclick="ubahUang(5000)">Tambah Uang</button>
        <button onclick="ubahUang(-5000)">Ambil Uang</button>
        <button onclick="setorUang()">Setor Rp 10.000</button>
        <button onclick="hapusAkun()">Hapus Akun</button><br><br>
        ${isAdmin ? `
          <button onclick="logoutAdmin()">Keluar Admin</button>
          <div class="panel"><h3>Panel Admin</h3>${getAdminPanel()}</div>
        ` : `<button onclick="loginAdmin()">Masuk Admin</button>`}
      </div>
    `;
  } else if (currentPage === "chat") {
    html = `
      <div class="panel">
        <h2>Chat</h2>
        <div id="chat-box">
          ${chatLog.map(c => `<div><b>${c.nama}:</b> ${c.teks}</div>`).join('')}
        </div>
        <button onclick="kirimChat()">Kirim Pesan</button>
      </div>
    `;
  } else if (currentPage === "top") {
    html = `
      <div class="panel">
        <h2>Top 3 Terkaya</h2>
        ${getTop3()}
      </div>
    `;
  }

  document.getElementById("main").innerHTML = html;
}

render();
</script>
</body>
</html>
