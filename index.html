<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>K7N PROJECT</title>

<style>
body{margin:0;font-family:Arial;background:#0d0014;color:#fff}
#loginBox,#waitBox{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center
}
.card{
  background:#101322;
  padding:25px;
  border-radius:14px;
  width:100%;
  max-width:380px
}
h2{text-align:center;color:#6ab8ff}
input,button{
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:8px;
  border:none
}
input{background:#0f1720;color:#fff}
button{background:#6ab8ff;font-weight:bold;cursor:pointer}
#msg{text-align:center;color:#ff6b6b;margin-top:10px}
#countdown{text-align:center;font-size:18px;margin-top:10px}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
  <div class="card">
    <h2>K7N LOGIN</h2>
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">LOGIN</button>
    <div id="msg"></div>
  </div>
</div>

<!-- TRANSISI -->
<div id="waitBox" style="display:none">
  <div class="card">
    <h2>MENYIAPKAN AKSES</h2>
    <div id="countdown"></div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const SESSION_KEY = "K7N_SESSION_V1";
const TARGET_URL = "http://serverpublik-pirzy.anti-ddos.me:2019/dashboard";
const TRIAL_TIME = 30 * 60 * 1000;
/* ========================================= */

const DB = [
  {username:"K7N", password:"nvrz", role:"OWNER"},
  {username:"TRIAL", password:"T30", role:"TRIAL"}
];

/* ===== LOGIN ===== */
function login(){
  const u = user.value.trim();
  const p = pass.value;

  const acc = DB.find(a=>a.username===u && a.password===p);
  if(!acc){ msg.innerText="Username / Password salah"; return; }

  const now = Date.now();
  const isTrial = acc.username === "TRIAL";

  const session = {
    username: acc.username,
    role: acc.role,
    createdAt: now,
    expireAt: isTrial ? now + TRIAL_TIME : null
  };

  session.lockHash = btoa(
    session.username + "|" +
    session.createdAt + "|" +
    (session.expireAt || "PERMANENT")
  );

  localStorage.setItem(SESSION_KEY, JSON.stringify(session));
  startRedirect();
}

/* ===== TRANSISI + COUNTDOWN ===== */
function startRedirect(){
  loginBox.style.display="none";
  waitBox.style.display="flex";

  const s = JSON.parse(localStorage.getItem(SESSION_KEY));

  let timeLeft = s.username==="TRIAL" ? 3 : 1; // detik sebelum redirect

  const timer = setInterval(()=>{
    countdown.innerText = 
      "Redirect dalam " + timeLeft + " detik...";
    timeLeft--;

    if(timeLeft < 0){
      clearInterval(timer);
      window.location.replace(TARGET_URL);
    }
  },1000);
}

/* ===== AUTO LOGIN JIKA ADA SESSION ===== */
(function(){
  const raw = localStorage.getItem(SESSION_KEY);
  if(!raw) return;

  const s = JSON.parse(raw);
  const now = Date.now();

  const lock = btoa(
    s.username + "|" +
    s.createdAt + "|" +
    (s.expireAt || "PERMANENT")
  );

  if(s.lockHash !== lock){
    localStorage.removeItem(SESSION_KEY);
    return;
  }

  if(s.username==="TRIAL" && now > s.expireAt){
    localStorage.removeItem(SESSION_KEY);
    return;
  }

  startRedirect();
})();
</script>

</body>
</html>
