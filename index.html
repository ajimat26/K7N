<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>UANGDUTY</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    h1 { color: green; }
    .admin-indicator { color: white; background: red; padding: 4px 8px; border-radius: 5px; display: inline-block; margin-left: 10px; }
    .admin-active { background: green; }
    .hidden { display: none; }
    button { margin: 5px; }
    input { margin: 5px; }
    .user-list, .history-log { margin-top: 10px; }
  </style>
</head>
<body>

<h1>UANGDUTY <span id="adminStatus" class="admin-indicator">Admin: OFF</span></h1>

<!-- Tombol Mode Admin -->
<button onclick="promptAdmin()">Mode Admin</button>

<!-- Hanya muncul jika admin aktif -->
<div id="adminPanel" class="hidden">
  <p><strong>Panel Admin Aktif</strong></p>
  <button onclick="toggleAccountCreation()">Tutup/Buka Pembuatan Akun</button>
  <p>Status Pembuatan Akun: <span id="accountStatus">Dibuka</span></p>
  <div class="user-list" id="userList"></div>
</div>

<hr>

<!-- Form Buat Akun -->
<div id="registerForm">
  <h3>Buat Akun</h3>
  <input type="text" id="username" placeholder="Nama Anda">
  <button onclick="createAccount()">Buat Akun</button>
</div>

<!-- Panel Uang -->
<div id="userPanel" class="hidden">
  <h3>Selamat datang, <span id="userName"></span></h3>
  <p>Saldo: <span id="userMoney" style="color:green;">0rb</span></p>
  <button onclick="addMoney()">+ Tambah Uang</button>
  <button onclick="takeMoney()">- Ambil Uang</button>
  <button onclick="resetMoney()">Setor / Reset</button>
</div>

<!-- Log Aktivitas -->
<h3>Riwayat (maks 5):</h3>
<ul id="historyLog" class="history-log"></ul>

<script>
  let isAdmin = false;
  let adminPassword = "RFD1";
  let accountCreationOpen = true;
  let currentUser = null;
  let accounts = JSON.parse(localStorage.getItem("accounts") || "{}");
  let history = JSON.parse(localStorage.getItem("history") || "[]");

  function saveData() {
    localStorage.setItem("accounts", JSON.stringify(accounts));
    localStorage.setItem("history", JSON.stringify(history));
  }

  function logHistory(text) {
    history.unshift(text);
    if (history.length > 5) history.pop();
    saveData();
    renderHistory();
  }

  function renderHistory() {
    const log = document.getElementById("historyLog");
    log.innerHTML = "";
    history.forEach(item => {
      const li = document.createElement("li");
      li.textContent = item;
      log.appendChild(li);
    });
  }

  function createAccount() {
    const name = document.getElementById("username").value;
    if (!accountCreationOpen) return alert("Pembuatan akun ditutup oleh admin.");
    if (!name) return alert("Nama tidak boleh kosong.");
    if (accounts[name]) return alert("Akun sudah dibuat.");
    currentUser = name;
    accounts[name] = { money: 0 };
    logHistory(`${name} membuat akun.`);
    saveData();
    updateUI();
  }

  function updateUI() {
    if (currentUser) {
      document.getElementById("registerForm").classList.add("hidden");
      document.getElementById("userPanel").classList.remove("hidden");
      document.getElementById("userName").textContent = currentUser;
      document.getElementById("userMoney").textContent = formatMoney(accounts[currentUser].money);
    }
  }

  function addMoney() {
    if (!currentUser) return;
    accounts[currentUser].money += 50000;
    logHistory(`${currentUser} menambah uang.`);
    saveData();
    updateUI();
  }

  function takeMoney() {
    if (!currentUser) return;
    accounts[currentUser].money -= 25000;
    logHistory(`${currentUser} mengambil uang.`);
    saveData();
    updateUI();
  }

  function resetMoney() {
    if (!currentUser) return;
    accounts[currentUser].money = 0;
    logHistory(`${currentUser} menyetor semua uang.`);
    saveData();
    updateUI();
  }

  function promptAdmin() {
    const pwd = prompt("Masukkan Password Admin:");
    if (pwd === adminPassword) {
      isAdmin = true;
      document.getElementById("adminPanel").classList.remove("hidden");
      document.getElementById("adminStatus").classList.add("admin-active");
      document.getElementById("adminStatus").textContent = "Admin: ON";
      renderAdminUsers();
    } else {
      alert("Password salah.");
    }
  }

  function toggleAccountCreation() {
    accountCreationOpen = !accountCreationOpen;
    document.getElementById("accountStatus").textContent = accountCreationOpen ? "Dibuka" : "Ditutup";
  }

  function renderAdminUsers() {
    const div = document.getElementById("userList");
    div.innerHTML = "<h4>Daftar Akun:</h4>";
    Object.keys(accounts).forEach(name => {
      const p = document.createElement("p");
      p.innerHTML = `${name} - <span style="color:green">${formatMoney(accounts[name].money)}</span> 
      <button onclick="renameUser('${name}')">Ganti Nama</button>
      <button onclick="deleteUser('${name}')">Hapus</button>`;
      div.appendChild(p);
    });
  }

  function renameUser(oldName) {
    const newName = prompt("Nama baru untuk " + oldName);
    if (!newName || accounts[newName]) return alert("Nama tidak valid.");
    accounts[newName] = accounts[oldName];
    delete accounts[oldName];
    if (currentUser === oldName) currentUser = newName;
    saveData();
    renderAdminUsers();
    updateUI();
  }

  function deleteUser(name) {
    if (confirm("Hapus akun " + name + "?")) {
      delete accounts[name];
      if (currentUser === name) currentUser = null;
      saveData();
      renderAdminUsers();
      location.reload();
    }
  }

  function formatMoney(m) {
    return m.toLocaleString("id-ID") + "rb";
  }

  // Inisialisasi
  renderHistory();
  updateUI();
</script>
</body>
                                              </html>
