<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Box Suplai & Penarikan</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
  button { margin: 5px 0; padding: 10px 15px; cursor: pointer; }
  #notif { margin: 10px 0; color: green; }
  #pesan, #riwayat, #adminLoginPanel, #adminPanel { display: none; margin-top: 15px; background: #fff; padding: 10px; border: 1px solid #ddd; }
  ul { padding-left: 20px; }
  input, select { padding: 5px; margin: 5px 0; width: 100%; max-width: 300px; }
  label { font-weight: bold; display: block; margin-top: 10px; }
</style>
</head>
<body>

<h2>Status</h2>
<p>Poin: <span id="points">0</span> | Kunci: <span id="keys">0</span></p>

<button id="btnOpenBox">Buka Box Acak</button>
<button id="btnSupply">Ambil Box Suplai (1x per jam)</button>
<button id="btnLihatPesan">Lihat Pesan</button>
<button id="btnRiwayatPenarikan">Riwayat Penarikan</button>

<div id="notif"></div>

<div id="pesan">
  <h3>Pesan</h3>
  <ul id="messageList"></ul>
  <button id="btnHapusPesan">Hapus Semua Pesan</button>
</div>

<div id="riwayat">
  <h3>Riwayat Penarikan</h3>
  <ul id="riwayatList"></ul>
</div>

<h3>Ajukan Penarikan</h3>
<label for="amount">Jumlah Poin:</label>
<select id="amount">
  <option value="1000">1000</option>
  <option value="2000">2000</option>
  <option value="5000">5000</option>
  <option value="10000">10000</option>
</select>

<label for="nama">Nama:</label>
<input type="text" id="nama" placeholder="Nama lengkap" />

<label for="rekening">No. Rekening:</label>
<input type="text" id="rekening" placeholder="No. rekening" />

<button id="btnAjukanPenarikan">Ajukan Penarikan</button>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const btnOpenBox = document.getElementById('btnOpenBox');
  const btnSupply = document.getElementById('btnSupply');
  const notif = document.getElementById('notif');
  const pointsSpan = document.getElementById('points');
  const keysSpan = document.getElementById('keys');
  const btnAjukanPenarikan = document.getElementById('btnAjukanPenarikan');
  const amountSelect = document.getElementById('amount');
  const namaInput = document.getElementById('nama');
  const rekeningInput = document.getElementById('rekening');
  const btnLihatPesan = document.getElementById('btnLihatPesan');
  const btnRiwayatPenarikan = document.getElementById('btnRiwayatPenarikan');
  const pesanPanel = document.getElementById('pesan');
  const riwayatPanel = document.getElementById('riwayat');
  const messageList = document.getElementById('messageList');
  const riwayatList = document.getElementById('riwayatList');
  const btnHapusPesan = document.getElementById('btnHapusPesan');

  // Data simpanan di localStorage
  let points = parseInt(localStorage.getItem('points') || '0');
  let keys = parseInt(localStorage.getItem('keys') || '0');
  let messages = JSON.parse(localStorage.getItem('messages') || '[]');
  let withdraws = JSON.parse(localStorage.getItem('withdraws') || '[]');
  let lastSupplyTime = parseInt(localStorage.getItem('lastSupplyTime') || '0');

  function updatePointsKeys() {
    pointsSpan.textContent = points;
    keysSpan.textContent = keys;
  }
  updatePointsKeys();

  function saveData() {
    localStorage.setItem('points', points);
    localStorage.setItem('keys', keys);
    localStorage.setItem('messages', JSON.stringify(messages));
    localStorage.setItem('withdraws', JSON.stringify(withdraws));
    localStorage.setItem('lastSupplyTime', lastSupplyTime);
  }

  // Tombol buka box acak (random poin dan kunci)
  btnOpenBox.addEventListener('click', () => {
    const hadiahPoin = Math.floor(Math.random() * 400) + 100;
    const hadiahKunci = Math.floor(Math.random() * 5) + 1;
    points += hadiahPoin;
    keys += hadiahKunci;
    updatePointsKeys();
    notif.textContent = `Selamat! Kamu mendapat ${hadiahPoin} poin dan ${hadiahKunci} kunci.`;
    saveData();
  });

  // Tombol ambil box suplai 1x per jam (15 kunci dan 100 poin)
  btnSupply.addEventListener('click', () => {
    const now = Date.now();
    const satuJam = 3600000;
    if (now - lastSupplyTime < satuJam) {
      const menitTersisa = Math.ceil((satuJam - (now - lastSupplyTime)) / 60000);
      notif.textContent = `Box suplai dapat diambil lagi setelah ${menitTersisa} menit.`;
      return;
    }
    points += 100;
    keys += 15;
    lastSupplyTime = now;
    updatePointsKeys();
    notif.textContent = "Kamu mendapatkan 15 kunci dan 100 poin dari box suplai!";
    saveData();
  });

  // Tampilkan pesan
  btnLihatPesan.addEventListener('click', () => {
    if (pesanPanel.style.display === 'block') {
      pesanPanel.style.display = 'none';
    } else {
      tampilkanPesan();
      pesanPanel.style.display = 'block';
      riwayatPanel.style.display = 'none';
    }
  });

  // Tampilkan riwayat penarikan
  btnRiwayatPenarikan.addEventListener('click', () => {
    if (riwayatPanel.style.display === 'block') {
      riwayatPanel.style.display = 'none';
    } else {
      tampilkanRiwayat();
      riwayatPanel.style.display = 'block';
      pesanPanel.style.display = 'none';
    }
  });

  function tampilkanPesan() {
    messageList.innerHTML = '';
    if (messages.length === 0) {
      messageList.innerHTML = '<li>Tidak ada pesan.</li>';
    } else {
      messages.forEach(msg => {
        const li = document.createElement('li');
        li.textContent = msg;
        messageList.appendChild(li);
      });
    }
  }

  btnHapusPesan.addEventListener('click', () => {
    if (confirm('Yakin ingin menghapus semua pesan?')) {
      messages = [];
      saveData();
      tampilkanPesan();
      notif.textContent = 'Semua pesan telah dihapus.';
    }
  });

  // Ajukan penarikan poin
  btnAjukanPenarikan.addEventListener('click', () => {
    const jumlahPoin = parseInt(amountSelect.value);
    const nama = namaInput.value.trim();
    const rekening = rekeningInput.value.trim();

    if (jumlahPoin > points) {
      notif.textContent = 'Poin kamu tidak cukup untuk penarikan.';
      return;
    }
    if (!nama) {
      notif.textContent = 'Nama tidak boleh kosong.';
      return;
    }
    if (!rekening) {
      notif.textContent = 'No. rekening tidak boleh kosong.';
      return;
    }

    // Simpan pengajuan penarikan
    withdraws.push({ nama, rekening, jumlah: jumlahPoin, tanggal: new Date().toLocaleString() });
    points -= jumlahPoin;
    updatePointsKeys();
    saveData();

    notif.textContent = 'Pengajuan penarikan berhasil dikirim.';
    namaInput.value = '';
    rekeningInput.value = '';
  });

  function tampilkanRiwayat() {
    riwayatList.innerHTML = '';
    if (withdraws.length === 0) {
      riwayatList.innerHTML = '<li>Tidak ada riwayat penarikan.</li>';
    } else {
      withdraws.forEach(wd => {
        const li = document.createElement('li');
        li.textContent = `${wd.tanggal} - ${wd.nama} menarik ${wd.jumlah} poin (Rek: ${wd.rekening})`;
        riwayatList.appendChild(li);
      });
    }
  }
});
</script>

</body>
  </html>
