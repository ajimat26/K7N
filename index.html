<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>UangDuty Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; margin: 10px; background: #f4f4f4; }
    h1 { color: #333; font-size: 20px; }
    .running-container {
      width: 100%;
      background: black;
      color: white;
      overflow: hidden;
      border-radius: 8px;
      padding: 6px;
      margin-bottom: 10px;
      font-size: 14px;
    }
    .running-text {
      display: inline-block;
      white-space: nowrap;
      padding-left: 100%;
      animation: scroll-left 40s linear infinite;
    }
    @keyframes scroll-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    .card {
      background: white;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: relative;
    }
    .riwayat { display: none; font-size: 13px; color: #555; margin-top: 8px; }
    .total { font-weight: bold; color: green; }
    .button { background: #007BFF; color: white; border: none; padding: 5px 10px; margin-top: 5px; border-radius: 5px; cursor: pointer; font-size: 13px; }
    .button:hover { background: #0056b3; }
    .dropdown {
      position: absolute;
      right: 10px;
      top: 10px;
    }
    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      background-color: #f9f9f9;
      border: 1px solid #ccc;
      min-width: 120px;
      z-index: 1;
      border-radius: 5px;
    }
    .dropdown-content button {
      width: 100%;
      padding: 8px;
      border: none;
      background: none;
      text-align: left;
      font-size: 13px;
    }
    .dropdown:hover .dropdown-content {
      display: block;
    }
    .top1 {
      position: absolute;
      right: 12px;
      top: 6px;
      font-size: 11px;
      color: orange;
      font-weight: bold;
    }
    .refresh-controls {
      font-size: 12px;
      margin: 10px 0;
    }
    .search {
      width: 100%;
      padding: 7px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>üìä UangDuty SAFD</h1>

  <div class="running-container" ontouchstart="pauseRunning()" ontouchend="resumeRunning()" onmousedown="pauseRunning()" onmouseup="resumeRunning()">
    <div id="running-text" class="running-text">Memuat data riwayat terbaru...</div>
  </div>

  <input type="text" class="search" placeholder="Cari nama..." oninput="filterForum(this.value)">
  <div class="refresh-controls">
    ‚è±Ô∏è Auto Refresh: 
    <select id="refreshInterval" onchange="setRefreshTime()">
      <option value="0">Mati</option>
      <option value="1" selected>1 menit</option>
      <option value="2">2 menit</option>
      <option value="3">3 menit</option>
      <option value="5">5 menit</option>
    </select>
    <span id="countdown" style="float: right;">‚è≥ 60s</span>
  </div>

  <div style="text-align: right; font-size: 12px; margin-bottom: 5px;"><b>üèÜ Top 1 Minggu Ini:</b> <span id="top1">-</span></div>

  <div id="data-container">Memuat data...</div>

  <script>
    let runningPaused = false;
    let resumeTimeout;
    let refreshTimer, countdownTimer;
    let remaining = 60;
    let fullData = {};

    function formatRupiah(angka) {
      return 'Rp. ' + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    function pauseRunning() {
      document.getElementById("running-text").style.animationPlayState = "paused";
      runningPaused = true;
      clearTimeout(resumeTimeout);
    }

    function resumeRunning() {
      clearTimeout(resumeTimeout);
      resumeTimeout = setTimeout(() => {
        document.getElementById("running-text").style.animationPlayState = "running";
        runningPaused = false;
      }, 4000);
    }

    function filterForum(keyword) {
      const cards = document.querySelectorAll(".card");
      keyword = keyword.toLowerCase();
      cards.forEach(card => {
        card.style.display = card.textContent.toLowerCase().includes(keyword) ? "block" : "none";
      });
    }

    function setRefreshTime() {
      clearInterval(refreshTimer);
      clearInterval(countdownTimer);
      const minutes = parseInt(document.getElementById("refreshInterval").value);
      if (minutes > 0) {
        remaining = minutes * 60;
        countdownTimer = setInterval(() => {
          remaining--;
          document.getElementById("countdown").textContent = `‚è≥ ${remaining}s`;
        }, 1000);
        refreshTimer = setInterval(fetchData, minutes * 60000);
      } else {
        document.getElementById("countdown").textContent = "‚è≥ Mati";
      }
    }

    function fetchData() {
      fetch("https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data.json")
        .then(res => res.json())
        .then(data => {
          fullData = data;
          const sorted = Object.entries(data).sort(([, a], [, b]) => (b.uang || 0) - (a.uang || 0));
          const container = document.getElementById("data-container");
          container.innerHTML = "";
          let top1 = sorted[0]?.[1]?.nama || "-";
          document.getElementById("top1").textContent = top1;
          const runningText = [];

          sorted.forEach(([nama, pemain], idx) => {
            const div = document.createElement("div");
            div.className = "card";
            const total = formatRupiah(pemain.uang || 0);
            const timeInfo = pemain.riwayat && pemain.riwayat.length > 0 ? pemain.riwayat.slice(-1)[0].split("]")[0].replace("[", "") : "-";
            div.innerHTML = `
              <div><strong>üìõ ${pemain.nama}</strong> ${idx === 0 ? '<span class="top1">üèÖTop 1</span>' : ""}</div>
              <div class="total">Total Uang: ${total}</div>
              <div style="font-size:12px;color:#777;">üìÜ Update Terakhir: ${timeInfo}</div>
              <button class="button" onclick="toggleRiwayat(this)">üìú Lihat Riwayat</button>
              <div class="riwayat">${pemain.riwayat && pemain.riwayat.length > 0 ? pemain.riwayat.map(r => "‚Ä¢ " + r).join("<br>") : "Tidak ada riwayat"}</div>
              <div class="dropdown">
                <span>‚ãÆ</span>
                <div class="dropdown-content">
                  <button>‚úèÔ∏è Ubah Nama</button>
                  <button>üóëÔ∏è Hapus Forum</button>
                </div>
              </div>`;
            container.appendChild(div);
            if (pemain.riwayat) {
              pemain.riwayat.slice(-3).forEach(r => runningText.push(`${pemain.nama}: ${r}`));
            }
          });

          document.getElementById("running-text").textContent = runningText.reverse().join(" | ");
        });
    }

    function toggleRiwayat(btn) {
      const r = btn.nextElementSibling;
      r.style.display = r.style.display === "none" ? "block" : "none";
      btn.textContent = r.style.display === "none" ? "üìú Lihat Riwayat" : "üìï Tutup Riwayat";
    }

    // Start
    fetchData();
    setRefreshTime();
  </script>
</body>
</html>
