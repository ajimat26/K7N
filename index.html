<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>K7N PROJECT</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#0d0014;
  color:#fff;
}

/* ===== LOGIN ===== */
#loginBox{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  background:#101322;
  padding:25px;
  border-radius:14px;
  width:100%;
  max-width:380px;
  box-shadow:0 0 25px rgba(0,0,0,.6);
}
h2{text-align:center;color:#6ab8ff}
input,button{
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:8px;
  border:none;
}
input{background:#0f1720;color:#fff}
button{
  background:#6ab8ff;
  font-weight:bold;
  cursor:pointer;
}
#msg{margin-top:10px;text-align:center;color:#ff6b6b}

/* ===== APP ===== */
#app{
  display:none;
  height:100vh;
}
#top{
  background:#101322;
  padding:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#content{
  height:calc(100vh - 50px);
}
iframe{
  width:100%;
  height:100%;
  border:none;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
  <div class="card">
    <h2>K7N LOGIN</h2>
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">LOGIN</button>
    <div id="msg"></div>
  </div>
</div>

<!-- APP -->
<div id="app">
  <div id="top">
    <span id="info"></span>
    <button onclick="logout()">LOGOUT</button>
  </div>
  <div id="content">
    <!-- WEBSITE TUJUAN DI SINI -->
    <iframe src="http://serverpublik-pirzy.anti-ddos.me:2019/dashboard"></iframe>
  </div>
</div>

<script>
/* ===================== CONFIG ===================== */
const SESSION_KEY = "K7N_SESSION_V1";
const DB = [
  {username:"K7N", password:"nvrz", role:"OWNER"},
  {username:"TRIAL", password:"T30", role:"TRIAL"}
];
const TRIAL_TIME = 30 * 60 * 1000; // 30 menit
/* ================================================= */

/* ===== LOGIN ===== */
function login(){
  const u = user.value.trim();
  const p = pass.value;

  const acc = DB.find(a=>a.username===u && a.password===p);
  if(!acc){ msg.innerText="Username / Password salah"; return; }

  const now = Date.now();
  const isTrial = acc.username === "TRIAL";

  const session = {
    username: acc.username,
    role: acc.role,
    createdAt: now,
    expireAt: isTrial ? now + TRIAL_TIME : null
  };

  session.lockHash = btoa(
    session.username + "|" +
    session.createdAt + "|" +
    (session.expireAt || "PERMANENT")
  );

  localStorage.setItem(SESSION_KEY, JSON.stringify(session));
  showApp();
}

/* ===== SHOW APP ===== */
function showApp(){
  const raw = localStorage.getItem(SESSION_KEY);
  if(!raw) return;

  const s = JSON.parse(raw);
  const lock = btoa(
    s.username + "|" + s.createdAt + "|" + (s.expireAt || "PERMANENT")
  );

  if(s.lockHash !== lock){
    localStorage.removeItem(SESSION_KEY);
    location.reload();
    return;
  }

  loginBox.style.display="none";
  app.style.display="block";

  updateInfo();
}

/* ===== INFO BAR ===== */
function updateInfo(){
  const s = JSON.parse(localStorage.getItem(SESSION_KEY));
  if(s.username==="TRIAL"){
    const left = Math.max(0, s.expireAt - Date.now());
    info.innerText = "TRIAL | Sisa: " + Math.floor(left/60000) + " menit";
  }else{
    info.innerText = "LOGIN: " + s.username + " (PERMANEN)";
  }
}

/* ===== AUTO EXPIRE ===== */
setInterval(()=>{
  const raw = localStorage.getItem(SESSION_KEY);
  if(!raw) return;

  const s = JSON.parse(raw);

  if(s.username==="TRIAL"){
    if(Date.now() > s.expireAt){
      localStorage.removeItem(SESSION_KEY);
      alert("â›” WAKTU TRIAL HABIS");
      location.reload();
    }else{
      updateInfo();
    }
  }
},1000);

/* ===== ANTI REFRESH (TRIAL) ===== */
window.addEventListener("beforeunload", function (e) {
  const raw = localStorage.getItem(SESSION_KEY);
  if(!raw) return;

  const s = JSON.parse(raw);
  if(s.username==="TRIAL"){
    e.preventDefault();
    e.returnValue = "";
  }
});

/* ===== LOGOUT ===== */
function logout(){
  localStorage.removeItem(SESSION_KEY);
  location.reload();
}

/* ===== AUTO LOGIN JIKA ADA SESSION ===== */
if(localStorage.getItem(SESSION_KEY)){
  showApp();
}
</script>

</body>
</html>
