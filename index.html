<!DOCTYPE html>
<html>
<head>
  <title>UANGDUTY</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    #adminStatus {
      font-size: 12px;
      color: white;
      background: red;
      padding: 2px 6px;
      border-radius: 4px;
      display: inline-block;
    }
    #adminControls {
      display: none;
      margin-top: 10px;
    }
    button {
      margin: 5px;
      padding: 6px 12px;
    }
    .hidden {
      display: none;
    }
    #chatBox {
      width: 100%;
      height: 150px;
      border: 1px solid #ccc;
      overflow-y: scroll;
      background: white;
      padding: 10px;
    }
    #formSection, #userPanel, #adminPanel {
      margin-top: 20px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

<h1>UANGDUTY</h1>
<div id="adminSection">
  <button onclick="enterAdminMode()" style="background: green; color: white;">Mode Admin</button>
  <span id="adminStatus">Admin: Nonaktif</span>
</div>

<div id="adminControls">
  <label><input type="checkbox" id="toggleRegister" onchange="toggleRegistration()"> Izinkan Pembuatan Akun</label>
</div>

<div id="formSection">
  <h2>Form Akun</h2>
  <input id="username" placeholder="Nama akun">
  <button onclick="createAccount()">Buat Akun</button>
</div>

<div id="userPanel" class="hidden">
  <h2>Selamat datang, <span id="userName"></span></h2>
  <p>Saldo: <span id="userMoney" style="color: green;">Rp0</span></p>

  <input id="amount" type="number" placeholder="Jumlah uang">
  <button onclick="addMoney()">Tambah Uang</button>
  <button onclick="withdrawMoney()">Ambil Uang</button>
  <button onclick="resetMoney()">Setor (Reset)</button>

  <h3>Riwayat (maks. 5)</h3>
  <ul id="historyList"></ul>
</div>

<div id="chatSection">
  <h2>Obrolan</h2>
  <div id="chatBox"></div>
  <input id="chatInput" placeholder="Ketik pesan">
  <button onclick="sendChat()">Kirim</button>
</div>

<div id="adminPanel" class="hidden">
  <h2>Panel Admin: Data Semua Akun</h2>
  <ul id="allAccounts"></ul>
</div>

<script>
let account = null;
let accounts = JSON.parse(localStorage.getItem('allAccounts') || '{}');
let chatLog = JSON.parse(localStorage.getItem('chatLog') || '[]');
let allowRegister = true;
let isAdmin = false;

function updateLocal() {
  localStorage.setItem('allAccounts', JSON.stringify(accounts));
}

function createAccount() {
  const name = document.getElementById("username").value;
  if (!allowRegister) return alert("Pembuatan akun sedang ditutup admin.");
  if (!name) return alert("Nama tidak boleh kosong");
  if (account) return alert("Akun sudah dibuat.");

  if (accounts[name]) return alert("Nama sudah dipakai.");
  accounts[name] = { money: 0, history: [] };
  updateLocal();
  login(name);
}

function login(name) {
  account = name;
  document.getElementById("formSection").classList.add("hidden");
  document.getElementById("userPanel").classList.remove("hidden");
  document.getElementById("userName").textContent = account;
  updateUI();
}

function updateUI() {
  document.getElementById("userMoney").textContent = "Rp" + formatMoney(accounts[account].money);
  const list = document.getElementById("historyList");
  list.innerHTML = "";
  accounts[account].history.slice(-5).forEach(item => {
    const li = document.createElement("li");
    li.textContent = item;
    list.appendChild(li);
  });
}

function addMoney() {
  const amount = parseInt(document.getElementById("amount").value);
  if (isNaN(amount) || amount <= 0) return;
  accounts[account].money += amount;
  addHistory("Tambah Rp" + formatMoney(amount));
  updateLocal();
  updateUI();
}

function withdrawMoney() {
  const amount = parseInt(document.getElementById("amount").value);
  if (isNaN(amount) || amount <= 0 || accounts[account].money < amount) return;
  accounts[account].money -= amount;
  addHistory("Ambil Rp" + formatMoney(amount));
  updateLocal();
  updateUI();
}

function resetMoney() {
  accounts[account].money = 0;
  addHistory("Setor (reset) saldo");
  updateLocal();
  updateUI();
}

function addHistory(text) {
  accounts[account].history.push(text);
  if (accounts[account].history.length > 5)
    accounts[account].history = accounts[account].history.slice(-5);
}

function sendChat() {
  const msg = document.getElementById("chatInput").value;
  if (!msg) return;
  chatLog.push(account + ": " + msg);
  if (chatLog.length > 50) chatLog = chatLog.slice(-50);
  localStorage.setItem('chatLog', JSON.stringify(chatLog));
  document.getElementById("chatInput").value = "";
  renderChat();
}

function renderChat() {
  const box = document.getElementById("chatBox");
  box.innerHTML = chatLog.map(m => `<div>${m}</div>`).join('');
  box.scrollTop = box.scrollHeight;
}

function formatMoney(n) {
  return n.toLocaleString('id-ID') + "rb";
}

function enterAdminMode() {
  const pass = prompt("Masukkan password admin:");
  if (pass === "RFD1") {
    isAdmin = true;
    document.getElementById("adminStatus").textContent = "Admin: Aktif";
    document.getElementById("adminStatus").style.background = "green";
    document.getElementById("adminControls").style.display = "block";
    document.getElementById("adminPanel").classList.remove("hidden");
    renderAdmin();
  } else {
    alert("Password salah.");
  }
}

function toggleRegistration() {
  allowRegister = document.getElementById("toggleRegister").checked;
}

function renderAdmin() {
  const panel = document.getElementById("allAccounts");
  panel.innerHTML = "";
  for (const name in accounts) {
    const li = document.createElement("li");
    li.textContent = `${name} - Rp${formatMoney(accounts[name].money)} `;
    const renameBtn = document.createElement("button");
    renameBtn.textContent = "Ubah Nama";
    renameBtn.onclick = () => {
      const newName = prompt("Masukkan nama baru:");
      if (newName && !accounts[newName]) {
        accounts[newName] = accounts[name];
        delete accounts[name];
        updateLocal();
        renderAdmin();
      }
    };
    const delBtn = document.createElement("button");
    delBtn.textContent = "Hapus";
    delBtn.onclick = () => {
      delete accounts[name];
      updateLocal();
      renderAdmin();
    };
    li.appendChild(renameBtn);
    li.appendChild(delBtn);
    panel.appendChild(li);
  }
}

renderChat();
</script>

</body>
</html>
