<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UangDuty Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 10px;
    }
    h1 {
      color: #333;
      font-size: 22px;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
    }
    .countdown {
      font-size: 14px;
      color: #666;
    }
    select {
      padding: 3px 5px;
    }
    .card {
      background: white;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: relative;
    }
    .riwayat {
      display: none;
      font-size: 13px;
      margin-top: 10px;
    }
    .total {
      font-weight: bold;
      color: green;
    }
    .actions {
      margin-top: 10px;
    }
    .actions button {
      margin-right: 5px;
      padding: 3px 8px;
      font-size: 12px;
    }
    .options {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
    }
    .tag {
      font-size: 12px;
      color: white;
      background: gold;
      padding: 2px 6px;
      border-radius: 5px;
      position: absolute;
      top: 10px;
      left: 10px;
    }
    .updated {
      font-size: 11px;
      color: #777;
      margin-top: 6px;
    }
    #running-text {
      background: black;
      color: white;
      padding: 6px;
      margin: 15px 0;
      white-space: nowrap;
      overflow: hidden;
    }
    #running-text span {
      display: inline-block;
      animation: scroll 130s linear infinite;
    }
    @keyframes scroll {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
  </style>
</head>
<body>
  <h1>üíº UangDuty SAFD</h1>
  <div class="controls">
    <div class="countdown">Refresh otomatis dalam <span id="timer">60</span>s</div>
    <div>
      Auto Refresh:
      <select id="refresh-interval">
        <option value="60000">1 menit</option>
        <option value="120000">2 menit</option>
        <option value="180000">3 menit</option>
        <option value="300000">5 menit</option>
        <option value="0">Mati</option>
      </select>
    </div>
  </div>  <div id="running-text"><span id="running-content">Memuat riwayat terbaru...</span></div>
  <div id="data-container">Memuat data...</div>  <script>
    let interval = 60000;
    let timer = 60;
    let userInteracting = false;
    const refreshSelect = document.getElementById("refresh-interval");

    refreshSelect.addEventListener("change", () => {
      interval = parseInt(refreshSelect.value);
      timer = interval / 1000;
    });

    function formatRupiah(num) {
      return 'Rp. ' + (num || 0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    function createCard(nama, data, rank) {
      const div = document.createElement("div");
      div.className = "card";
      const tag = rank <= 3 ? `<div class="tag">üèÜ Juara ${rank}</div>` : "";
      const total = formatRupiah(data.uang);
      const waktu = data.updated || "-";
      const riwayatList = data.riwayat?.map(r => `‚Ä¢ ${r}`).join("<br>") || "Tidak ada riwayat";
      div.innerHTML = `
        ${tag}
        <div class="options">‚ãÆ</div>
        <strong>üìõ ${data.nama}</strong><br>
        <span class="total">Total Uang: ${total}</span>
        <div class="updated">Terakhir diubah: ${waktu}</div>
        <div class="riwayat">
          <br><u>üìú Riwayat:</u><br>${riwayatList}
        </div>
        <div class="actions">
          <button class="lihat-btn">üìú Lihat Riwayat</button>
          <button class="tutup-btn" style="display:none;">‚ùå Tutup Riwayat</button>
        </div>`;

      const riwayat = div.querySelector(".riwayat");
      const lihatBtn = div.querySelector(".lihat-btn");
      const tutupBtn = div.querySelector(".tutup-btn");
      const options = div.querySelector(".options");

      lihatBtn.onclick = () => {
        userInteracting = true;
        riwayat.style.display = "block";
        lihatBtn.style.display = "none";
        tutupBtn.style.display = "inline-block";
      };
      tutupBtn.onclick = () => {
        riwayat.style.display = "none";
        lihatBtn.style.display = "inline-block";
        tutupBtn.style.display = "none";
        userInteracting = false;
      };

      options.onclick = () => {
        if (userInteracting) return;
        const choice = prompt("Pilih opsi:\n1. ‚úèÔ∏è Ubah Nama\n2. üóëÔ∏è Hapus Forum");
        if (choice === "1") {
          const newName = prompt("Masukkan nama baru:");
          if (newName) {
            fetch(`https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data/${nama}.json`, {
              method: "PATCH",
              body: JSON.stringify({ nama: newName }),
              headers: { "Content-Type": "application/json" }
            }).then(loadData);
          }
        } else if (choice === "2") {
          if (confirm("Yakin ingin menghapus forum ini?")) {
            fetch(`https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data/${nama}.json`, {
              method: "DELETE"
            }).then(loadData);
          }
        }
      };

      return div;
    }

    function loadData() {
      fetch("https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data.json")
        .then(res => res.json())
        .then(data => {
          if (!data) return;
          const container = document.getElementById("data-container");
          container.innerHTML = "";
          const entries = Object.entries(data).sort((a,b) => b[1].uang - a[1].uang);
          entries.forEach(([nama, data], i) => {
            const card = createCard(nama, data, i+1);
            container.appendChild(card);
          });

          const riwayatAll = entries.flatMap(([_,d]) => d.riwayat || []).reverse().slice(0, 10).map(r => r).join(" ‚ùñ ");
          document.getElementById("running-content").textContent = riwayatAll || "Belum ada aktivitas.";
        });
    }

    loadData();
    setInterval(() => {
      if (interval === 0 || userInteracting) return;
      if (--timer <= 0) {
        loadData();
        timer = interval / 1000;
      }
      document.getElementById("timer").textContent = timer;
    }, 1000);
  </script></body>
</html>
