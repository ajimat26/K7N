<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UangDuty SAFD</title>
  <style>
    body { font-family: sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
    .forum { background: #fff; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: relative; }
    .title { font-weight: bold; font-size: 18px; }
    .uang { color: green; }
    .status-online { color: green; font-size: 14px; }
    .status-offline { color: red; font-size: 14px; }
    .dots { position: absolute; right: 15px; top: 15px; cursor: pointer; }
    .menu { display: none; position: absolute; right: 15px; top: 35px; background: white; border: 1px solid #ccc; border-radius: 5px; z-index: 1; }
    .menu button { display: block; background: none; border: none; padding: 10px; width: 100%; text-align: left; cursor: pointer; }
    .menu button:hover { background: #eee; }
    .riwayat { margin-top: 10px; font-size: 14px; display: none; }
    .pesan-btn { background: #007BFF; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; margin-top: 10px; }
    .pesan-btn:hover { background: #0056b3; }
  </style>
</head>
<body>
  <h1>📋 Forum Uang Duty SAFD</h1>
  <div id="forums"></div>  <script>
    async function fetchData() {
      const res = await fetch("https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data.json");
      const data = await res.json();
      const container = document.getElementById("forums");
      container.innerHTML = "";
      if (!data) return;

      Object.entries(data).forEach(([nama, info]) => {
        const forum = document.createElement("div");
        forum.className = "forum";

        const title = document.createElement("div");
        title.className = "title";
        title.textContent = `👤 ${nama}`;
        forum.appendChild(title);

        const uang = document.createElement("div");
        uang.innerHTML = `💰 Total Uang: <span class='uang'>${info.uang?.toLocaleString("id-ID", { style: 'currency', currency: 'IDR' }) || 'Rp. 0'}</span>`;
        forum.appendChild(uang);

        const status = document.createElement("div");
        if (info.status === "online") {
          status.className = "status-online";
          status.textContent = `🟢 Sedang aktif di kota ${info.kota || 'Tidak diketahui'}`;
        } else {
          status.className = "status-offline";
          status.textContent = `🔴 Sedang tidak aktif`;
        }
        forum.appendChild(status);

        // Tombol Kirim Pesan
        const btnPesan = document.createElement("button");
        btnPesan.className = "pesan-btn";
        btnPesan.textContent = "📩 Kirim Pesan";
        btnPesan.onclick = async () => {
          const teks = prompt("Masukkan pesan yang ingin dikirim:");
          if (teks && teks.trim() !== "") {
            const exp = Math.floor(Date.now() / 1000) + 2 * 60 * 60; // +2 jam
            await fetch(`https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data/${nama}.json`, {
              method: "PATCH",
              body: JSON.stringify({ pesan: teks, pesan_exp: exp })
            });
            alert("Pesan terkirim!");
          }
        };
        forum.appendChild(btnPesan);

        // Titik Tiga Menu
        const dots = document.createElement("div");
        dots.className = "dots";
        dots.textContent = "︙";

        const menu = document.createElement("div");
        menu.className = "menu";

        const btnRename = document.createElement("button");
        btnRename.textContent = "✏️ Ubah Nama";
        btnRename.onclick = async () => {
          const newName = prompt("Masukkan nama baru:", nama);
          if (newName && newName !== nama) {
            await fetch(`https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data/${newName}.json`, {
              method: "PUT",
              body: JSON.stringify(info)
            });
            await fetch(`https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data/${nama}.json`, {
              method: "DELETE"
            });
            fetchData();
          }
        };

        const btnDelete = document.createElement("button");
        btnDelete.textContent = "🗑️ Hapus Forum";
        btnDelete.onclick = async () => {
          if (confirm(`Apakah yakin ingin menghapus forum ${nama}?`)) {
            await fetch(`https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data/${nama}.json`, {
              method: "DELETE"
            });
            fetchData();
          }
        };

        menu.appendChild(btnRename);
        menu.appendChild(btnDelete);
        forum.appendChild(dots);
        forum.appendChild(menu);

        dots.onclick = () => {
          menu.style.display = menu.style.display === "block" ? "none" : "block";
        };

        // Riwayat
        const riwayat = document.createElement("div");
        riwayat.className = "riwayat";
        if (info.riwayat) {
          riwayat.innerHTML = "<strong>Riwayat:</strong><br>" + info.riwayat.map(r => `• ${r}`).join("<br>");
        }
        forum.onclick = () => {
          riwayat.style.display = riwayat.style.display === "block" ? "none" : "block";
        };
        forum.appendChild(riwayat);

        container.appendChild(forum);
      });
    }

    fetchData();
    setInterval(fetchData, 5000);
  </script></body>
</html>
