<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>K7N Access</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0b0012;
  color:#fff;
}
#login,#wait{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  background:#11162a;
  padding:25px;
  border-radius:14px;
  width:100%;
  max-width:360px;
}
h2{text-align:center;color:#7cc4ff}
input,button{
  width:100%;
  padding:12px;
  margin-top:12px;
  border:none;
  border-radius:8px;
}
input{background:#0f1720;color:#fff}
button{background:#7cc4ff;font-weight:bold;cursor:pointer}
#msg{text-align:center;color:#ff6b6b;margin-top:10px}
#cd{text-align:center;margin-top:10px;font-size:18px}
</style>
</head>
<body>

<div id="login">
  <div class="card">
    <h2>K7N ACCESS</h2>
    <input id="pw" type="password" placeholder="Password">
    <button onclick="login()">MASUK</button>
    <div id="msg"></div>
  </div>
</div>

<div id="wait" style="display:none">
  <div class="card">
    <h2>MENYIAPKAN AKSES</h2>
    <div id="cd"></div>
  </div>
</div>

<script>
/* ============== CONFIG ================= */
const STORAGE = "K7N_TOKEN_SESSION";
const TARGET = atob(
  "aHR0cDovL3NlcnZlcnB1Ymxpay1waXJ6eS5hbnRpLWRkb3MubWU6MjAxOS9kYXNoYm9hcmQ="
);
const TRIAL_TIME = 30 * 60 * 1000;
const SECRET = "K7N@2025";
/* ====================================== */

/* HASH SEDERHANA */
function sign(str){
  let h = 0;
  for(let i=0;i<str.length;i++){
    h = (h<<5) - h + str.charCodeAt(i);
    h |= 0;
  }
  return btoa(h.toString());
}

/* GENERATE TOKEN */
function createToken(role, exp){
  const ts = Date.now();
  const rnd = Math.random().toString(36).slice(2,10);
  const raw = `K7N|${role}|${ts}|${rnd}|${exp ?? "âˆž"}`;
  return raw + "|" + sign(raw + SECRET);
}

function login(){
  const p = pw.value;
  let role = null;
  let exp = null;

  if(p === "nvrz") role = "OWNER";
  if(p === "T30"){
    role = "TRIAL";
    exp = Date.now() + TRIAL_TIME;
  }

  if(!role){
    msg.innerText = "Password salah";
    return;
  }

  const token = createToken(role, exp);
  localStorage.setItem(STORAGE, JSON.stringify({
    token, role, exp
  }));

  redirect();
}

function redirect(){
  login.style.display="none";
  wait.style.display="flex";

  let t = 3;
  const i = setInterval(()=>{
    cd.innerText = "Redirect dalam " + t + " detik...";
    if(--t < 0){
      clearInterval(i);
      window.location.replace(TARGET);
    }
  },1000);
}

/* AUTO CHECK TOKEN */
(function(){
  const raw = localStorage.getItem(STORAGE);
  if(!raw) return;

  const s = JSON.parse(raw);
  const parts = s.token.split("|");
  if(parts.length !== 6){
    localStorage.removeItem(STORAGE);
    return;
  }

  const checkRaw = parts.slice(0,5).join("|");
  if(sign(checkRaw + SECRET) !== parts[5]){
    localStorage.removeItem(STORAGE);
    return;
  }

  if(s.role === "TRIAL" && Date.now() > s.exp){
    localStorage.removeItem(STORAGE);
    return;
  }

  redirect();
})();
</script>

</body>
</html>
