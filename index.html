<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>UANGDUTY - Forum Investasi & Uang</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
  h1 { color: #2b6cb0; }
  #infoPengguna { margin-bottom: 15px; font-weight: bold; font-size: 1.1em; }
  #akunSection, #forumSection, #staffSection {
    background: white;
    padding: 15px 20px;
    border-radius: 8px;
    max-width: 700px;
    margin-bottom: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  #akunSection input, #forumSection input[type=number], #staffSection input[type=password] {
    padding: 8px;
    margin: 8px 0;
    width: 100%;
    box-sizing: border-box;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  button {
    background: #2b6cb0;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 10px 18px;
    cursor: pointer;
    margin-top: 10px;
    font-weight: bold;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #1e4e8c;
  }
  #saldo {
    color: green;
    font-weight: bold;
    font-size: 1.3em;
  }
  #riwayat {
    margin-top: 20px;
    max-height: 160px;
    overflow-y: auto;
    border: 1px solid #ddd;
    padding: 10px;
    background: #fafafa;
    border-radius: 5px;
  }
  #riwayat p {
    margin: 4px 0;
    font-size: 0.9em;
    color: #444;
  }
  #chatSection {
    margin-top: 20px;
  }
  #chatBox {
    background: #fff;
    border: 1px solid #ccc;
    height: 210px;
    overflow-y: auto;
    padding: 12px;
    border-radius: 5px;
    font-size: 0.9em;
    color: #222;
  }
  #chatBox p {
    margin: 6px 0;
    padding: 6px 10px;
    background: #e9f1fb;
    border-radius: 10px;
  }
  #chatInput {
    margin-top: 8px;
    padding: 10px;
    width: 100%;
    box-sizing: border-box;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 1em;
  }
  #btnStaffMode {
    background: #dd6b20;
    margin-bottom: 30px;
  }
  #staffSection {
    display: none;
  }
  #listForum div {
    background: #f0f0f0;
    padding: 12px;
    margin-bottom: 8px;
    border-radius: 6px;
    font-size: 0.95em;
  }
</style>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>

<h1>UANGDUTY</h1>
<div id="infoPengguna"></div>

<div id="akunSection" style="display:none;">
  <h3>Buat Akun Baru</h3>
  <input type="text" id="namaDepan" placeholder="Nama Depan" />
  <input type="text" id="namaBelakang" placeholder="Nama Belakang" />
  <button onclick="buatAkun()">Buat Akun</button>
</div>

<div id="forumSection" style="display:none;">
  <h2>Dashboard UANGDUTY</h2>
  <p>Saldo Anda: <span id="saldo">0</span></p>

  <div>
    <input type="number" id="inputTambah" placeholder="Jumlah tambah (contoh: 50000)" />
    <button onclick="tambahUang()">Tambah Uang</button>
  </div>
  <div>
    <input type="number" id="inputAmbil" placeholder="Jumlah ambil (contoh: 25000)" />
    <button onclick="ambilUang()">Ambil Uang</button>
  </div>
  <div>
    <button onclick="setorUang()">Setor Uang (Reset saldo ke 0)</button>
  </div>

  <div id="riwayat">
    <h4>Riwayat Transaksi:</h4>
    <p>Belum ada riwayat transaksi.</p>
  </div>

  <div id="chatSection">
    <h4>Obrolan Forum</h4>
    <div id="chatBox"></div>
    <input type="text" id="chatInput" placeholder="Ketik pesan dan tekan Enter..." onkeydown="if(event.key==='Enter'){kirimPesan();}" />
  </div>
</div>

<button id="btnStaffMode" onclick="masukStaffMode()">Mode Staff</button>

<div id="staffSection">
  <h2>Panel Staff</h2>
  <input type="password" id="passwordStaff" placeholder="Masukkan password staff" />
  <button onclick="cekPasswordStaff()">Masuk</button>
  <div id="listForum"></div>
</div>

<script>
  // --- FIREBASE CONFIG ---
  const firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "PROJECT_ID.firebaseapp.com",
    databaseURL: "https://PROJECT_ID.firebaseio.com",
    projectId: "PROJECT_ID",
    storageBucket: "PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let userKey = localStorage.getItem("userKey");
  let fullName = localStorage.getItem("fullName");
  let staffLogin = false;

  function formatRupiah(angka) {
    return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".") + " Rupiah";
  }

  function cekStatusAkun() {
    if(userKey && fullName) {
      document.getElementById("infoPengguna").innerText = `Selamat datang, ${fullName}`;
      document.getElementById("akunSection").style.display = "none";
      document.getElementById("forumSection").style.display = "block";
      pantauSaldo();
      pantauRiwayat();
      pantauChat();
    } else {
      document.getElementById("infoPengguna").innerText = "Anda belum memiliki akun, silakan buat akun.";
      document.getElementById("akunSection").style.display = "block";
      document.getElementById("forumSection").style.display = "none";
    }
  }

  function buatAkun() {
    const depan = document.getElementById("namaDepan").value.trim();
    const belakang = document.getElementById("namaBelakang").value.trim();

    if (!depan || !belakang) {
      alert("Lengkapi nama depan dan belakang.");
      return;
    }

    if (userKey) {
      alert("Anda sudah memiliki akun, tidak bisa membuat akun baru.");
      return;
    }

    const namaLengkap = `${depan} ${belakang}`;

    const ref = db.ref("forum").push();
    ref.set({
      nama: namaLengkap,
      saldo: 0
    }).then(() => {
      userKey = ref.key;
      fullName = namaLengkap;
      localStorage.setItem("userKey", userKey);
      localStorage.setItem("fullName", fullName);
      alert("Akun berhasil dibuat. Selamat datang, " + fullName);
      cekStatusAkun();
    });
  }

  function pantauSaldo() {
    db.ref(`forum/${userKey}/saldo`).on("value", snap => {
      let val = snap.val() || 0;
      document.getElementById("saldo").innerText = formatRupiah(val);
    });
  }

  function tambahRiwayat(teks) {
    const riwayat
