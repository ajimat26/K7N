<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UangDuty SAFD</title>
  <style>
    body { font-family: sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
    .forum { background: #fff; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: relative; }
    .title { font-weight: bold; font-size: 18px; }
    .uang { color: green; }
    .dots { position: absolute; right: 15px; top: 15px; cursor: pointer; }
    .menu { display: none; position: absolute; right: 15px; top: 35px; background: white; border: 1px solid #ccc; border-radius: 5px; z-index: 1; }
    .menu button { display: block; background: none; border: none; padding: 10px; width: 100%; text-align: left; cursor: pointer; }
    .menu button:hover { background: #eee; }
    .riwayat { margin-top: 10px; font-size: 14px; display: none; }
    #pesanForm { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    #pesanForm textarea { width: 100%; padding: 10px; font-size: 14px; }
    #pesanForm button { margin-top: 10px; padding: 8px 12px; font-size: 14px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>üìã Forum Uang Duty SAFD</h1>  <div id="pesanForm">
    <h3>üìù Kirim Pesan untuk Semua Pengguna</h3>
    <textarea id="isiPesan" rows="3" placeholder="Tulis pesan di sini..."></textarea>
    <button onclick="kirimPesan()">Kirim Pesan</button>
  </div>  <div id="forums"></div>  <script>
    async function fetchData() {
      const res = await fetch("https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data.json");
      const data = await res.json();
      const container = document.getElementById("forums");
      container.innerHTML = "";
      if (!data) return;

      Object.entries(data).forEach(([nama, info]) => {
        const forum = document.createElement("div");
        forum.className = "forum";

        const title = document.createElement("div");
        title.className = "title";
        title.textContent = `üë§ ${nama}`;
        forum.appendChild(title);

        const uang = document.createElement("div");
        uang.innerHTML = `üí∞ Total Uang: <span class='uang'>${info.uang?.toLocaleString("id-ID", { style: 'currency', currency: 'IDR' }) || 'Rp. 0'}</span>`;
        forum.appendChild(uang);

        // Titik Tiga Menu
        const dots = document.createElement("div");
        dots.className = "dots";
        dots.textContent = "Ô∏ô";

        const menu = document.createElement("div");
        menu.className = "menu";

        const btnRename = document.createElement("button");
        btnRename.textContent = "‚úèÔ∏è Ubah Nama";
        btnRename.onclick = async () => {
          const newName = prompt("Masukkan nama baru:", nama);
          if (newName && newName !== nama) {
            await fetch(`https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data/${newName}.json`, {
              method: "PUT",
              body: JSON.stringify(info)
            });
            await fetch(`https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data/${nama}.json`, {
              method: "DELETE"
            });
            fetchData();
          }
        };

        const btnDelete = document.createElement("button");
        btnDelete.textContent = "üóëÔ∏è Hapus Forum";
        btnDelete.onclick = async () => {
          if (confirm(`Apakah yakin ingin menghapus forum ${nama}?`)) {
            await fetch(`https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/data/${nama}.json`, {
              method: "DELETE"
            });
            fetchData();
          }
        };

        menu.appendChild(btnRename);
        menu.appendChild(btnDelete);
        forum.appendChild(dots);
        forum.appendChild(menu);

        dots.onclick = () => {
          menu.style.display = menu.style.display === "block" ? "none" : "block";
        };

        const riwayat = document.createElement("div");
        riwayat.className = "riwayat";
        if (info.riwayat) {
          riwayat.innerHTML = "<strong>Riwayat:</strong><br>" + info.riwayat.map(r => `‚Ä¢ ${r}`).join("<br>");
        }
        forum.onclick = () => {
          riwayat.style.display = riwayat.style.display === "block" ? "none" : "block";
        };
        forum.appendChild(riwayat);

        container.appendChild(forum);
      });
    }

    async function kirimPesan() {
      const isi = document.getElementById("isiPesan").value.trim();
      if (!isi) return alert("Isi pesan tidak boleh kosong.");
      const waktu = new Date().toISOString();
      await fetch("https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app/pesan.json", {
        method: "PUT",
        body: JSON.stringify({ isi: isi, waktu: waktu })
      });
      alert("Pesan berhasil dikirim ke semua pengguna.");
      document.getElementById("isiPesan").value = "";
    }

    fetchData();
    setInterval(fetchData, 5000);
  </script></body>
</html>
