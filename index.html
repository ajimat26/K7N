<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>SAFD MONEY</title>
  <style>
    body {
      font-family: Arial;
      background-color: #f9f9f9;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h2 {
      color: #003366;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    .panel {
      background: white;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      min-width: 280px;
      flex: 1;
    }
    .panel input, .panel button {
      margin: 5px 0;
      padding: 8px;
      width: 100%;
    }
    .money {
      color: green;
      font-weight: bold;
    }
    #chat-box {
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid #aaa;
      padding: 10px;
      margin-top: 10px;
      background: #eef;
    }
    #top-tier span {
      display: block;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="main"></div>

<script>
let akun = JSON.parse(localStorage.getItem("akun"));
let isAdmin = JSON.parse(localStorage.getItem("admin")) || false;
let riwayatChat = JSON.parse(localStorage.getItem("chatLog")) || [];

function simpanAkun() {
  localStorage.setItem("akun", JSON.stringify(akun));
}

function simpanAdmin(status) {
  localStorage.setItem("admin", JSON.stringify(status));
}

function simpanChat() {
  localStorage.setItem("chatLog", JSON.stringify(riwayatChat));
}

function formatRupiah(nominal) {
  return "Rp " + nominal.toLocaleString("id-ID");
}

function renderApp() {
  const container = document.getElementById("main");
  container.innerHTML = "";
  if (!akun) {
    container.innerHTML = `
      <div class="panel">
        <h2>Buat Akun</h2>
        <input type="text" id="namaAkun" placeholder="Nama Anda">
        <button onclick="buatAkun()">Buat</button>
      </div>
    `;
  } else {
    let html = `
      <div class="container">
        <div class="panel">
          <h2>Halo, ${akun.nama}</h2>
          <div>Saldo: <span class="money">${formatRupiah(akun.uang)}</span></div>
          <button onclick="ubahUang(5000)">Tambah Uang</button>
          <button onclick="ubahUang(-5000)">Ambil Uang</button>
          <button onclick="setorUang()">Setor Rp 10.000</button>
          <button onclick="resetAkun()">Hapus Akun</button>
        </div>

        <div class="panel">
          <h2>Chat</h2>
          <div id="chat-box">${riwayatChat.map(c => `<div><b>${c.nama}:</b> ${c.teks}</div>`).join('')}</div>
          <input type="text" id="chatInput" placeholder="Tulis pesan...">
          <button onclick="kirimChat()">Kirim</button>
        </div>

        <div class="panel">
          <h2>Top Tier</h2>
          <div id="top-tier">${getTopTier()}</div>
        </div>

        <div class="panel">
          <h2>Admin</h2>
          ${isAdmin ? `
            <div><b>Nama Admin:</b> ${akun.nama}</div>
            <div id="panel-admin">${getAdminPanel()}</div>
            <button onclick="ubahNamaAdmin()">Ubah Nama Admin</button>
            <button onclick="keluarAdmin()">Keluar Admin</button>
          ` : `
            <input type="password" id="adminPass" placeholder="Password Admin">
            <button onclick="loginAdmin()">Login Admin</button>
          `}
        </div>
      </div>
    `;
    container.innerHTML = html;
  }
}

function buatAkun() {
  const nama = document.getElementById("namaAkun").value.trim();
  if (!nama) return alert("Nama harus diisi");
  akun = { nama: nama, uang: 0 };
  simpanAkun();
  renderApp();
}

function resetAkun() {
  if (confirm("Hapus akun ini?")) {
    localStorage.removeItem("akun");
    renderApp();
  }
}

function ubahUang(jumlah) {
  akun.uang = Math.max(0, akun.uang + jumlah);
  simpanAkun();
  renderApp();
}

function setorUang() {
  akun.uang += 10000;
  simpanAkun();
  renderApp();
}

function kirimChat() {
  const teks = document.getElementById("chatInput").value.trim();
  if (!teks) return;
  riwayatChat.push({ nama: akun.nama, teks: teks });
  if (riwayatChat.length > 5) riwayatChat.shift();
  simpanChat();
  renderApp();
}

function loginAdmin() {
  const pass = document.getElementById("adminPass").value;
  if (pass === "RFD1") {
    isAdmin = true;
    simpanAdmin(true);
    renderApp();
  } else {
    alert("Password salah");
  }
}

function keluarAdmin() {
  isAdmin = false;
  simpanAdmin(false);
  renderApp();
}

function getTopTier() {
  let all = JSON.parse(localStorage.getItem("allData")) || {};
  if (akun) all[akun.nama] = akun;
  localStorage.setItem("allData", JSON.stringify(all));

  let sorted = Object.values(all).sort((a, b) => b.uang - a.uang).slice(0, 3);
  return sorted.map((x, i) => `${i + 1}. ${x.nama} - <span class="money">${formatRupiah(x.uang)}</span>`).join("<br>");
}

function getAdminPanel() {
  let all = JSON.parse(localStorage.getItem("allData")) || {};
  return Object.keys(all).map(nama => `
    <div style="margin-bottom:5px;">
      <b>${nama}</b> - ${formatRupiah(all[nama].uang)}
      <button onclick="hapusUser('${nama}')">Hapus</button>
      <button onclick="gantiNama('${nama}')">Edit Nama</button>
    </div>
  `).join('');
}

function hapusUser(nama) {
  let all = JSON.parse(localStorage.getItem("allData"));
  delete all[nama];
  localStorage.setItem("allData", JSON.stringify(all));
  if (akun?.nama === nama) {
    localStorage.removeItem("akun");
    renderApp();
  } else {
    renderApp();
  }
}

function gantiNama(namaLama) {
  let baru = prompt("Nama baru:", namaLama);
  if (!baru) return;
  let all = JSON.parse(localStorage.getItem("allData"));
  all[baru] = all[namaLama];
  all[baru].nama = baru;
  delete all[namaLama];
  if (akun?.nama === namaLama) {
    akun.nama = baru;
    simpanAkun();
  }
  localStorage.setItem("allData", JSON.stringify(all));
  renderApp();
}

function ubahNamaAdmin() {
  let baru = prompt("Nama admin baru:", akun.nama);
  if (!baru) return;
  akun.nama = baru;
  simpanAkun();
  renderApp();
}

renderApp();
</script>
</body>
</html>
