<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>SAFD MONEY</title>
  <style>
    body {
      background-color: #f5f5f5;
      color: #333;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input, button {
      padding: 8px;
      margin: 5px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background-color: #2c7;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #2a5;
    }
    .panel {
      background: white;
      padding: 15px;
      margin-top: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .hidden { display: none; }
    .chat-box {
      border: 1px solid #ccc;
      height: 150px;
      overflow-y: auto;
      background: #fafafa;
      padding: 10px;
    }
    .money { color: green; font-weight: bold; }
  </style>
</head>
<body>

<h1>SAFD MONEY</h1>

<div id="createAccountPanel" class="panel hidden">
  <h3>Buat Akun</h3>
  <input type="text" id="newName" placeholder="Nama Anda">
  <input type="number" id="initialMoney" placeholder="Uang Awal">
  <button onclick="createAccount()">Buat Akun</button>
</div>

<div id="adminLoginPanel" class="panel">
  <h3>Login Admin</h3>
  <input type="password" id="adminPass" placeholder="Password Admin">
  <button onclick="adminLogin()">Login Admin</button>
</div>

<div id="forumPanel" class="panel hidden">
  <h3>Forum SAFD MONEY</h3>
  <p>Selamat datang, <b><span id="userNameDisplay"></span></b></p>
  <p>Total Uang: <span id="userMoneyDisplay" class="money"></span></p>
  <div class="chat-box" id="chatBox"></div>
  <input type="text" id="chatInput" placeholder="Tulis pesan...">
  <button onclick="sendChat()">Kirim</button>
</div>

<div id="adminPanel" class="panel hidden">
  <h3>Panel Admin</h3>
  <p>Nama Admin: <span id="adminName"></span></p>
  <div id="userList"></div>
  <h4>Top Tier</h4>
  <div id="topTier"></div>
</div>

<script>
  let users = JSON.parse(localStorage.getItem("users") || "[]");
  let chats = JSON.parse(localStorage.getItem("chats") || "[]");
  let akun = JSON.parse(localStorage.getItem("akun") || "null");
  let isAdmin = false;
  let adminName = "";

  function saveData() {
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("chats", JSON.stringify(chats));
    localStorage.setItem("akun", JSON.stringify(akun));
  }

  function formatMoney(val) {
    return "Rp " + Number(val).toLocaleString("id-ID");
  }

  function createAccount() {
    const name = document.getElementById("newName").value.trim();
    const money = parseInt(document.getElementById("initialMoney").value);
    if (!name || isNaN(money)) return alert("Isi nama dan uang!");
    akun = { name, money };
    users.push(akun);
    saveData();
    showForum();
    document.getElementById("createAccountPanel").classList.add("hidden");
  }

  function adminLogin() {
    const pass = document.getElementById("adminPass").value;
    if (pass === "RFD1") {
      adminName = prompt("Nama Admin:");
      isAdmin = true;
      akun = null;
      saveData();
      document.getElementById("adminLoginPanel").classList.add("hidden");
      document.getElementById("forumPanel").classList.remove("hidden");
      document.getElementById("adminPanel").classList.remove("hidden");
      document.getElementById("userNameDisplay").innerText = adminName + " (Admin)";
      document.getElementById("userMoneyDisplay").innerText = formatMoney(0);
      document.getElementById("adminName").innerText = adminName;
      loadUserList();
      showTopTier();
      loadChats();
    } else {
      alert("Password salah!");
    }
  }

  function showForum() {
    document.getElementById("forumPanel").classList.remove("hidden");
    document.getElementById("userNameDisplay").innerText = akun.name;
    document.getElementById("userMoneyDisplay").innerText = formatMoney(akun.money);
    loadChats();
  }

  function sendChat() {
    const input = document.getElementById("chatInput");
    const text = input.value.trim();
    if (!text) return;
    const sender = isAdmin ? adminName + " (Admin)" : akun.name;
    chats.push({ name: sender, text });
    input.value = "";
    saveData();
    loadChats();
  }

  function loadChats() {
    const box = document.getElementById("chatBox");
    box.innerHTML = chats.map(c => `<div><b>${c.name}:</b> ${c.text}</div>`).join("");
    box.scrollTop = box.scrollHeight;
  }

  function loadUserList() {
    const list = document.getElementById("userList");
    list.innerHTML = users.map((u, i) => `
      <div>
        <b>${u.name}</b> - ${formatMoney(u.money)}
        <button onclick="editUser(${i})">Edit</button>
        <button onclick="deleteUser(${i})">Hapus</button>
      </div>
    `).join("");
  }

  function editUser(index) {
    const newName = prompt("Ubah nama:", users[index].name);
    if (newName) {
      users[index].name = newName;
      saveData();
      loadUserList();
      showTopTier();
    }
  }

  function deleteUser(index) {
    if (confirm("Hapus akun ini?")) {
      const deleted = users.splice(index, 1)[0];
      if (akun && akun.name === deleted.name) {
        akun = null;
        localStorage.removeItem("akun");
        document.getElementById("forumPanel").classList.add("hidden");
        document.getElementById("createAccountPanel").classList.remove("hidden");
      }
      saveData();
      loadUserList();
      showTopTier();
    }
  }

  function showTopTier() {
    const top = [...users].sort((a, b) => b.money - a.money).slice(0, 3);
    const list = document.getElementById("topTier");
    list.innerHTML = top.map((u, i) => `${i+1}. ${u.name} - ${formatMoney(u.money)}`).join("<br>");
  }

  // Auto load
  window.onload = () => {
    if (akun) {
      showForum();
    } else if (users.length === 0) {
      document.getElementById("createAccountPanel").classList.remove("hidden");
    }
  }
</script>

</body>
</html>
