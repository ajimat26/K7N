<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SAFD MONEY</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f5f7fa;
    color: #222;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
  }
  .section {
    margin-bottom: 30px;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 8px #ccc;
  }
  input, button, textarea, select {
    margin: 5px 0;
    padding: 10px;
    width: 100%;
    box-sizing: border-box;
    font-size: 14px;
    border-radius: 5px;
    border: 1px solid #bbb;
  }
  button {
    cursor: pointer;
    background: #2c8;
    color: white;
    font-weight: bold;
    border: none;
    transition: background 0.3s;
  }
  button:hover {
    background: #269a4a;
  }
  .chat-box {
    border: 1px solid #ccc;
    padding: 10px;
    max-height: 180px;
    overflow-y: scroll;
    background: #fafafa;
    border-radius: 5px;
  }
  .message {
    margin-bottom: 10px;
  }
  .right {
    text-align: right;
    color: #005500;
  }
  #saldo {
    color: green;
    font-weight: bold;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  table, th, td {
    border: 1px solid #bbb;
  }
  th, td {
    padding: 8px;
    text-align: left;
  }
  .top-tier {
    background: #e0ffe0;
    padding: 10px;
    border-radius: 6px;
  }
  .admin-panel input, .admin-panel button {
    width: auto;
    display: inline-block;
    margin-right: 10px;
  }
  #adminSection {
    display: none;
  }
  .flex-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  .flex-col {
    flex: 1;
    min-width: 280px;
  }
  #panelContainer {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  #accountPanel, #moneyPanel, #adminSection {
    flex: 1;
    min-width: 300px;
  }
  #chatContainer {
    margin-top: 15px;
  }
  #topTierSection {
    margin-top: 15px;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 8px #ccc;
  }
</style>
</head>
<body>

<h1>SAFD MONEY</h1>

<div id="panelContainer">
  <!-- Account panel -->
  <div class="section" id="accountPanel">
    <h2>Akun Anda</h2>
    <div id="createAccountPanel">
      <input type="text" id="namaDepan" placeholder="Nama Depan" />
      <input type="text" id="namaBelakang" placeholder="Nama Belakang" />
      <button onclick="buatAkun()">Buat Forum Anda</button>
    </div>
    <p id="infoPengguna"></p>
  </div>

  <!-- Money & History panel -->
  <div class="section" id="moneyPanel" style="display:none;">
    <h2>Forum Anda</h2>
    <p><strong>Saldo:</strong> <span id="saldo">Rp 0</span></p>
    <input type="number" id="jumlah" placeholder="Jumlah Uang" />
    <button onclick="tambahUang()">Tambah</button>
    <button onclick="ambilUang()">Ambil</button>
    <button onclick="setorUang()">Setor (Reset)</button>
    <div id="riwayat"></div>
  </div>

  <!-- Admin panel -->
  <div class="section admin-panel" id="adminSection">
    <h2>Admin Panel</h2>
    <p>Admin: <input type="text" id="adminName" style="width:150px" /></p>
    <button onclick="updateAdminName()">Ubah Nama Admin</button>
    <button onclick="logoutAdmin()">Keluar Admin</button>
    <hr />
    <h3>Daftar Akun Anggota</h3>
    <table>
      <thead><tr><th>Nama</th><th>Saldo</th><th>Aksi</th></tr></thead>
      <tbody id="anggotaList"></tbody>
    </table>
  </div>
</div>

<!-- Buttons to switch views -->
<div class="section flex-row" style="margin-bottom:20px;">
  <button onclick="showPanel('money')">Forum & Uang</button>
  <button onclick="showPanel('chat')">Chat</button>
  <button onclick="showPanel('topTier')">Top Tier</button>
  <button onclick="toggleAdminLogin()">Login Admin</button>
</div>

<!-- Chat Panel -->
<div class="section" id="chatPanel" style="display:none;">
  <h2>Obrolan</h2>
  <div class="chat-box" id="chatBox"></div>
  <textarea id="pesan" placeholder="Ketik pesan Anda"></textarea>
  <button onclick="kirimPesan()">Kirim</button>
</div>

<!-- Top Tier Panel -->
<div class="section" id="topTierSection" style="display:none;">
  <h2>Top Tier - 3 Orang dengan Saldo Terbesar</h2>
  <ol id="topTierList"></ol>
</div>

<!-- Admin Login Panel -->
<div class="section" id="adminLoginPanel" style="display:none;">
  <h2>Login Admin</h2>
  <input type="password" id="adminPass" placeholder="Masukkan Password Admin" />
  <button onclick="loginAdmin()">Login</button>
  <p id="adminLoginInfo" style="color:red"></p>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA3-34rf9VZUIrAIR6z4BJtQm_MClqXm-Q",
    authDomain: "uangduty.firebaseapp.com",
    databaseURL: "https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "uangduty",
    storageBucket: "uangduty.appspot.com",
    messagingSenderId: "598905752132",
    appId: "1:598905752132:web:9b764840e51c3044a11",
    measurementId: "G-YXZPEVYBDR"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let userKey = localStorage.getItem("userKey");
  let fullName = localStorage.getItem("fullName");
  let isAdmin = localStorage.getItem("isAdmin") === "true";
  let adminName = localStorage.getItem("adminName") || "Admin";
  let adminPassCorrect = "RFD1";

  // Show panel helpers
  function showPanel(name) {
    document.getElementById("moneyPanel").style.display = name === "money" ? "block" : "none";
    document.getElementById("chatPanel").style.display = name === "chat" ? "block" : "none";
    document.getElementById("topTierSection").style.display = name === "topTier" ? "block" : "none";
    document.getElementById("adminLoginPanel").style.display = "none";
  }

  function toggleAdminLogin() {
    if (isAdmin) {
      alert("Anda sudah login sebagai admin.");
      return;
    }
    document.getElementById("adminLoginPanel").style.display = "block";
    showPanel(""); // hide other panels
  }

  function setUserPanelVisible(visible) {
    document.getElementById("moneyPanel").style.display = visible ? "block" : "none";
    document.getElementById("accountPanel").style.display = visible ? "none" : "block";
    if (!visible) clearUserData();
  }

  function clearUserData() {
    userKey = null;
    fullName = null;
    localStorage.removeItem("userKey");
    localStorage.removeItem("fullName");
  }

  // Format number to Rupiah
  function formatRupiah(num) {
    return "Rp " + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  }

  // Create account
  function buatAkun() {
    const depan = document.get
