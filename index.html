<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Game Kotak Hadiah</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
    button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    #maintenanceNotice { color: red; font-weight: bold; margin: 10px 0; }
    #adminPanel, #adminLoginPanel, #pesanPanel, #riwayatPanel { display: none; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Game Kotak Hadiah</h1>
  <p>Poin: <span id="points">0</span> | Kunci: <span id="keys">0</span></p>

  <div id="maintenanceNotice"></div>

  <button id="btnOpenBox">Buka Kotak</button>
  <button id="btnSupply">Box Suplai</button>
  <br><br>

  <h3>Penarikan</h3>
  <input id="inputNama" placeholder="Nama" />
  <input id="inputRek" placeholder="Rekening" />
  <select id="amountSelect">
    <option value="2500">2.500</option>
    <option value="5000">5.000</option>
    <option value="10000">10.000</option>
  </select>
  <button id="btnAjukanPenarikan">Ajukan</button>
  <br><br>

  <button id="btnLihatPesan">Pesan</button>
  <button id="btnRiwayatPenarikan">Riwayat</button>
  <button id="btnHapusPesan">Hapus Pesan</button>
  <div id="notif" style="color: red; margin-top: 10px;"></div>

  <div id="pesanPanel">
    <h3>Pesan</h3>
    <ul id="messageList"></ul>
  </div>

  <div id="riwayatPanel">
    <h3>Riwayat Penarikan</h3>
    <ul id="riwayatList"></ul>
  </div>

  <hr>
  <button id="btnAdminPanel">Admin</button>

  <div id="adminLoginPanel">
    <input id="adminPassInput" type="password" placeholder="Password admin" />
    <button id="btnLoginAdmin">Login</button>
    <button id="btnBatalLoginAdmin">Batal</button>
    <div id="adminLoginNotif" style="color: red;"></div>
  </div>

  <div id="adminPanel">
    <h3>Admin Panel</h3>
    <h4>Pending Penarikan</h4>
    <ul id="pendingWithdrawList"></ul>

    <h4>Maintenance</h4>
    <input id="maintenanceReasonInput" placeholder="Alasan Maintenance" />
    <input id="maintenanceDurationInput" type="number" placeholder="Durasi (menit)" />
    <button id="btnStartMaintenance">Mulai</button>
    <button id="btnStopMaintenance">Berhenti</button>
    <br><br>
    <button id="btnLogoutAdmin">Logout Admin</button>
  </div>

  <script>
    const pointsSpan = document.getElementById("points");
    const keysSpan = document.getElementById("keys");
    const btnOpenBox = document.getElementById("btnOpenBox");
    const btnSupply = document.getElementById("btnSupply");
    const btnAjukanPenarikan = document.getElementById("btnAjukanPenarikan");
    const inputNama = document.getElementById("inputNama");
    const inputRek = document.getElementById("inputRek");
    const amountSelect = document.getElementById("amountSelect");
    const btnLihatPesan = document.getElementById("btnLihatPesan");
    const btnRiwayatPenarikan = document.getElementById("btnRiwayatPenarikan");
    const btnHapusPesan = document.getElementById("btnHapusPesan");
    const notifDiv = document.getElementById("notif");
    const messageList = document.getElementById("messageList");
    const riwayatList = document.getElementById("riwayatList");
    const pesanPanel = document.getElementById("pesanPanel");
    const riwayatPanel = document.getElementById("riwayatPanel");
    const maintenanceNotice = document.getElementById("maintenanceNotice");

    const btnAdminPanel = document.getElementById("btnAdminPanel");
    const btnLoginAdmin = document.getElementById("btnLoginAdmin");
    const btnLogoutAdmin = document.getElementById("btnLogoutAdmin");
    const btnBatalLoginAdmin = document.getElementById("btnBatalLoginAdmin");
    const adminPassInput = document.getElementById("adminPassInput");
    const adminLoginPanel = document.getElementById("adminLoginPanel");
    const adminLoginNotif = document.getElementById("adminLoginNotif");
    const adminPanel = document.getElementById("adminPanel");
    const pendingWithdrawList = document.getElementById("pendingWithdrawList");
    const maintenanceReasonInput = document.getElementById("maintenanceReasonInput");
    const maintenanceDurationInput = document.getElementById("maintenanceDurationInput");
    const btnStartMaintenance = document.getElementById("btnStartMaintenance");
    const btnStopMaintenance = document.getElementById("btnStopMaintenance");

    const STORAGE_POINTS = "gh_points";
    const STORAGE_KEYS = "gh_keys";
    const STORAGE_MESSAGES = "gh_messages";
    const STORAGE_WITHDRAWS = "gh_withdraws";
    const STORAGE_MAINTENANCE = "gh_maintenance";
    const STORAGE_ADMIN = "gh_admin";
    const STORAGE_LAST_SUPPLY = "gh_last_supply";

    const ADMIN_PASSWORD = "admin123";

    let points = parseInt(localStorage.getItem(STORAGE_POINTS)) || 0;
    let keys = parseInt(localStorage.getItem(STORAGE_KEYS)) || 0;
    let messages = JSON.parse(localStorage.getItem(STORAGE_MESSAGES)) || [];
    let withdraws = JSON.parse(localStorage.getItem(STORAGE_WITHDRAWS)) || [];
    let maintenance = JSON.parse(localStorage.getItem(STORAGE_MAINTENANCE)) || { active: false };
    let adminLoggedIn = localStorage.getItem(STORAGE_ADMIN) === "true";
    let lastSupplyTime = parseInt(localStorage.getItem(STORAGE_LAST_SUPPLY)) || 0;

    function saveData() {
      localStorage.setItem(STORAGE_POINTS, points);
      localStorage.setItem(STORAGE_KEYS, keys);
      localStorage.setItem(STORAGE_MESSAGES, JSON.stringify(messages));
      localStorage.setItem(STORAGE_WITHDRAWS, JSON.stringify(withdraws));
      localStorage.setItem(STORAGE_MAINTENANCE, JSON.stringify(maintenance));
      localStorage.setItem(STORAGE_ADMIN, adminLoggedIn ? "true" : "false");
      localStorage.setItem(STORAGE_LAST_SUPPLY, lastSupplyTime);
      updateUI();
    }

    function updateUI() {
      pointsSpan.innerText = points;
      keysSpan.innerText = keys;
      notifDiv.innerText = "";

      if (maintenance.active) {
        maintenanceNotice.innerText = `Maintenance Aktif: ${maintenance.reason} (selesai dalam ${Math.max(0, Math.ceil((maintenance.end - Date.now()) / 60000))} menit)`;
        maintenanceNotice.style.display = "block";
        btnOpenBox.disabled = true;
        btnAjukanPenarikan.disabled = true;
        btnSupply.disabled = true;
      } else {
        maintenanceNotice.style.display = "none";
        btnOpenBox.disabled = false;
        btnAjukanPenarikan.disabled = false;
        btnSupply.disabled = false;
      }

      messageList.innerHTML = messages.map(msg => `<li>${msg}</li>`).join("");
      riwayatList.innerHTML = withdraws.map(w => `<li>${w.nama} - ${w.rek} - ${w.jumlah} poin</li>`).join("");

      if (adminLoggedIn) {
        adminLoginPanel.style.display = "none";
        adminPanel.style.display = "block";
        pendingWithdrawList.innerHTML = withdraws.map((w, i) => 
          `<li>${w.nama} - ${w.rek} - ${w.jumlah} poin <button onclick="hapusWithdraw(${i})">Selesai</button></li>`
        ).join("");
      } else {
        adminPanel.style.display = "none";
      }
    }

    function hapusWithdraw(index) {
      withdraws.splice(index, 1);
      saveData();
    }

    function bukaKotak() {
      if (keys <= 0) return notifDiv.innerText = "Kamu tidak punya kunci!";
      keys--;
      let hadiah = Math.floor(Math.random() * 150) + 50;
      points += hadiah;
      messages.push(`Kamu membuka kotak dan dapat ${hadiah} poin!`);
      saveData();
    }

    function ambilSuplai() {
      const now = Date.now();
      if (now - lastSupplyTime < 3600000) {
        notifDiv.innerText = "Suplai hanya bisa diambil 1 jam sekali!";
        return;
      }
      keys++;
      lastSupplyTime = now;
      messages.push("Kamu menerima 1 kunci dari Box Suplai!");
      saveData();
    }

    function ajukanPenarikan() {
      let nama = inputNama.value.trim();
      let rek = inputRek.value.trim();
      let jumlah = parseInt(amountSelect.value);
      if (!nama || !rek) return notifDiv.innerText = "Isi semua data penarikan!";
      if (points < jumlah) return notifDiv.innerText = "Poin kamu tidak cukup!";
      withdraws.push({ nama, rek, jumlah });
      messages.push(`Kamu mengajukan penarikan ${jumlah} poin.`);
      points -= jumlah;
      inputNama.value = "";
      inputRek.value = "";
      saveData();
    }

    function startMaintenance() {
      let reason = maintenanceReasonInput.value.trim();
      let duration = parseInt(maintenanceDurationInput.value);
      if (!reason || !duration || duration < 1) {
        notifDiv.innerText = "Isi alasan dan durasi maintenance!";
        return;
      }
      maintenance = {
        active: true,
        reason: reason,
        end: Date.now() + duration * 60000
      };
      saveData();
    }

    function stopMaintenance() {
      maintenance = { active: false };
      saveData();
    }

    btnOpenBox.onclick = bukaKotak;
    btnSupply.onclick = ambilSuplai;
    btnAjukanPenarikan.onclick = ajukanPenarikan;
    btnLihatPesan.onclick = () => pesanPanel.style.display = pesanPanel.style.display === "block" ? "none" : "block";
    btnRiwayatPenarikan.onclick = () => riwayatPanel.style.display = riwayatPanel.style.display === "block" ? "none" : "block";
    btnHapusPesan.onclick = () => { messages = []; saveData(); };

    btnAdminPanel.onclick = () => adminLoginPanel.style.display = "block";
    btnBatalLoginAdmin.onclick = () => adminLoginPanel.style.display = "none";
    btnLoginAdmin.onclick = () => {
      if (adminPassInput.value === ADMIN_PASSWORD) {
        adminLoggedIn = true;
        adminPassInput.value = "";
        saveData();
      } else {
        adminLoginNotif.innerText = "Password salah!";
      }
    };
    btnLogoutAdmin.onclick = () => {
      adminLoggedIn = false;
      saveData();
    };
    btnStartMaintenance.onclick = startMaintenance;
    btnStopMaintenance.onclick = stopMaintenance;

    if (maintenance.active && Date.now() > maintenance.end) {
      maintenance = { active: false };
      saveData();
    }

    updateUI();
  </script>
</body>
</html>
