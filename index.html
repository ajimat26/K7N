<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Box Kunci</title>
  <style>
    body { font-family: Arial; text-align: center; padding: 20px; }
    #boxAnimation { width: 100px; height: 100px; margin: 20px auto; background: #f4a261; }
    #boxAnimation.shake { animation: shake 0.5s; }
    @keyframes shake {
      0% { transform: translate(0); }
      25% { transform: translate(5px, 5px); }
      50% { transform: translate(-5px, -5px); }
      75% { transform: translate(5px, -5px); }
      100% { transform: translate(0); }
    }
    #notif { color: green; font-weight: bold; margin-top: 10px; }
    #maintenanceNotice { color: red; font-weight: bold; display: none; }
    button { margin: 5px; padding: 10px 20px; }
  </style>
</head>
<body>
  <h2>Game Box Kunci</h2>
  <div>Point: <span id="point">0</span> | Kunci: <span id="key">0</span></div>
  <div id="boxAnimation"></div>
  <button id="btnOpenBox">Buka Box</button>
  <button id="btnSupplyBox">Box Suplai</button>
  <div id="notif"></div>
  <br><br>
  <input type="text" id="nama" placeholder="Nama">
  <input type="text" id="rekening" placeholder="Rekening">
  <input type="number" id="amount" placeholder="Jumlah Poin">
  <button id="btnAjukanPenarikan">Ajukan Penarikan</button>
  <button id="btnRiwayatPenarikan">Riwayat Penarikan</button>
  <button id="btnLihatPesan">Lihat Pesan</button>
  <button id="btnHapusPesan">Hapus Pesan</button>
  <br><br>
  <button id="btnAdminPanel">Admin</button>
  <div id="maintenanceNotice"></div>
  <div id="pesan" style="display:none"></div>
  <div id="riwayat" style="display:none">
    <ul id="riwayatList"></ul>
  </div>
  <div id="adminLoginPanel" style="display:none">
    <input type="password" id="adminPass" placeholder="Password Admin">
    <button id="btnLoginAdmin">Login</button>
    <button id="btnBatalLoginAdmin">Batal</button>
    <div id="adminLoginNotif"></div>
  </div>
  <div id="adminPanel" style="display:none">
    <textarea id="maintenanceReason" placeholder="Alasan maintenance"></textarea>
    <input type="number" id="maintenanceDuration" placeholder="Durasi (menit)">
    <button id="btnStartMaintenance">Mulai Maintenance</button>
    <button id="btnStopMaintenance">Akhiri Maintenance</button>
    <button id="btnLogoutAdmin">Logout</button>
  </div>
  <script>
    const STORAGE_POINTS = "points";
    const STORAGE_KEYS = "keys";
    const STORAGE_MESSAGES = "messages";
    const STORAGE_WITHDRAWS = "withdraws";
    const STORAGE_ADMIN = "admin";
    const STORAGE_MAINTENANCE = "maintenance";

    let points = parseInt(localStorage.getItem(STORAGE_POINTS) || "0");
    let keys = parseInt(localStorage.getItem(STORAGE_KEYS) || "0");
    let messages = JSON.parse(localStorage.getItem(STORAGE_MESSAGES) || "[]");
    let withdraws = JSON.parse(localStorage.getItem(STORAGE_WITHDRAWS) || "[]");
    let adminLoggedIn = localStorage.getItem(STORAGE_ADMIN) === "true";
    let maintenance = JSON.parse(localStorage.getItem(STORAGE_MAINTENANCE) || "null");

    const rewards = [
      { name: "Hadiah Kecil", point: 10 },
      { name: "Hadiah Sedang", point: 25 },
      { name: "Hadiah Besar", point: 100 },
      { name: "Zonk", point: 0 },
      { name: "2x Point Berikutnya", point: -1 }
    ];

    function updatePoints() {
      document.getElementById("point").innerText = points;
      localStorage.setItem(STORAGE_POINTS, points);
    }
    function updateKeys() {
      document.getElementById("key").innerText = keys;
      localStorage.setItem(STORAGE_KEYS, keys);
    }
    function notif(text) {
      document.getElementById("notif").innerText = text;
    }
    function addMessage(msg) {
      messages.push(msg);
      localStorage.setItem(STORAGE_MESSAGES, JSON.stringify(messages));
    }

    function tampilPesan() {
      const el = document.getElementById("pesan");
      el.innerHTML = messages.map(m => `<p>${m}</p>`).join("");
    }

    function tampilRiwayat() {
      const ul = document.getElementById("riwayatList");
      ul.innerHTML = "";
      withdraws.forEach(w => {
        const li = document.createElement("li");
        li.textContent = `${w.nama} - ${w.rekening} - ${w.amount} poin`;
        ul.appendChild(li);
      });
    }

    function getSupplyBox() {
      const randKeys = Math.floor(Math.random() * 6) + 15;
      const randPoints = Math.floor(Math.random() * 171) + 30;
      keys += randKeys;
      points += randPoints;
      updateKeys();
      updatePoints();
      notif(`Kamu mendapatkan ${randKeys} kunci dan ${randPoints} poin dari Box Suplai!`);
      addMessage(`Dapat ${randKeys} kunci & ${randPoints} poin dari Box Suplai`);
    }

    document.getElementById("btnOpenBox").addEventListener("click", function () {
      if (keys <= 0) {
        notif("Kunci tidak cukup!");
        return;
      }
      keys--;
      updateKeys();
      const box = document.getElementById("boxAnimation");
      box.classList.add("shake");
      setTimeout(() => {
        box.classList.remove("shake");
        const reward = rewards[Math.floor(Math.random() * rewards.length)];
        if (reward.point > 0) {
          points += reward.point;
          notif(`Kamu mendapat ${reward.name} (${reward.point} poin)!`);
        } else if (reward.point === 0) {
          notif("Zonk! Tidak dapat apa-apa.");
        } else {
          points *= 2;
          notif("Reward berikutnya akan 2x lipat!");
        }
        updatePoints();
      }, 600);
    });

    document.getElementById("btnAjukanPenarikan").addEventListener("click", function () {
      const amount = parseInt(document.getElementById("amount").value);
      const nama = document.getElementById("nama").value.trim();
      const rekening = document.getElementById("rekening").value.trim();
      if (points < amount) return notif("Poin tidak mencukupi.");
      if (!nama || !rekening) return notif("Nama dan rekening harus diisi.");
      points -= amount;
      updatePoints();
      withdraws.push({ nama, rekening, amount });
      localStorage.setItem(STORAGE_WITHDRAWS, JSON.stringify(withdraws));
      notif("Permintaan penarikan dikirim.");
      addMessage(`Penarikan oleh ${nama} (${amount} poin).`);
    });

    document.getElementById("btnLihatPesan").addEventListener("click", () => {
      document.getElementById("pesan").style.display = "block";
      tampilPesan();
    });
    document.getElementById("btnRiwayatPenarikan").addEventListener("click", () => {
      document.getElementById("riwayat").style.display = "block";
      tampilRiwayat();
    });
    document.getElementById("btnHapusPesan").addEventListener("click", () => {
      messages = [];
      localStorage.setItem(STORAGE_MESSAGES, "[]");
      tampilPesan();
    });

    document.getElementById("btnAdminPanel").addEventListener("click", () => {
      if (adminLoggedIn) document.getElementById("adminPanel").style.display = "block";
      else document.getElementById("adminLoginPanel").style.display = "block";
    });
    document.getElementById("btnBatalLoginAdmin").addEventListener("click", () => {
      document.getElementById("adminLoginPanel").style.display = "none";
    });
    document.getElementById("btnLoginAdmin").addEventListener("click", () => {
      const pass = document.getElementById("adminPass").value;
      if (pass === "admin123") {
        adminLoggedIn = true;
        localStorage.setItem(STORAGE_ADMIN, "true");
        document.getElementById("adminLoginPanel").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
      } else {
        document.getElementById("adminLoginNotif").innerText = "Password salah.";
      }
    });
    document.getElementById("btnLogoutAdmin").addEventListener("click", () => {
      adminLoggedIn = false;
      localStorage.removeItem(STORAGE_ADMIN);
      document.getElementById("adminPanel").style.display = "none";
    });

    document.getElementById("btnStartMaintenance").addEventListener("click", () => {
      const reason = document.getElementById("maintenanceReason").value;
      const duration = parseInt(document.getElementById("maintenanceDuration").value);
      if (!reason || !duration) return notif("Isi alasan dan durasi maintenance.");
      const expires = Date.now() + duration * 60000;
      maintenance = { reason, expires };
      localStorage.setItem(STORAGE_MAINTENANCE, JSON.stringify(maintenance));
      location.reload();
    });
    document.getElementById("btnStopMaintenance").addEventListener("click", () => {
      localStorage.removeItem(STORAGE_MAINTENANCE);
      location.reload();
    });
    document.getElementById("btnSupplyBox").addEventListener("click", getSupplyBox);

    window.onload = function () {
      if (maintenance && Date.now() < maintenance.expires) {
        document.getElementById("gamePanel").style.display = "none";
        const reason = maintenance.reason;
        const mins = Math.ceil((maintenance.expires - Date.now()) / 60000);
        const notice = `Game sedang maintenance (${reason}) - Sisa waktu: ${mins} menit.`;
        document.getElementById("maintenanceNotice").style.display = "block";
        document.getElementById("maintenanceNotice").innerText = notice;
      } else {
        updatePoints();
        updateKeys();
      }
    }
  </script>
</body>
</html>
