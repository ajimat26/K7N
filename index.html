<!DOCTYPE html><html>
<head>
  <title>SAFD MONEY</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body { font-family: Arial; }
    #uang { color: green; }
    .panel { display: none; border: 1px solid #ccc; padding: 10px; margin: 10px; }
    .top-tier { font-weight: bold; color: darkgreen; }
  </style>
</head>
<body><h2>SAFD MONEY</h2>
<div id="panelPembuatanAkun" class="panel">
  <input type="text" id="namaBaru" placeholder="Nama Akun">
  <button onclick="buatAkun()">Buat Akun</button>
</div><div id="panelUtama" class="panel">
  <p>Selamat datang, <span id="namaPengguna"></span>!</p>
  <p id="uang">Saldo: <span id="saldo"></span></p>
  <input type="text" id="pesanInput" placeholder="Tulis pesan">
  <button onclick="kirimChat()">Kirim</button>
  <div id="chatBox"></div>
</div><div id="panelAdmin" class="panel">
  <h3>Panel Admin</h3>
  <input type="password" id="adminPass" placeholder="Password Admin">
  <button onclick="masukAdmin()">Masuk</button>  <div id="adminKontrol" style="display:none;">
    <p>Nama Admin: <span id="namaAdmin"></span></p>
    <h4>Daftar Akun</h4>
    <ul id="daftarAkun"></ul>
    <h4>Top Tier</h4>
    <ol id="topTier"></ol>
  </div>
</div><script>
  var firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "PROJECT_ID.firebaseapp.com",
    databaseURL: "https://PROJECT_ID.firebaseio.com",
    projectId: "PROJECT_ID",
    storageBucket: "PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);

  var uid = null;
  var namaPengguna = "";

  firebase.auth().onAuthStateChanged(user => {
    if (user) {
      uid = user.uid;
      const ref = firebase.database().ref('akun/' + uid);
      ref.once('value').then(snap => {
        if (snap.exists()) {
          namaPengguna = snap.val().nama;
          document.getElementById('namaPengguna').innerText = namaPengguna;
          document.getElementById('panelUtama').style.display = 'block';
          document.getElementById('panelPembuatanAkun').style.display = 'none';
          loadChat();
        } else {
          document.getElementById('panelPembuatanAkun').style.display = 'block';
          document.getElementById('panelUtama').style.display = 'none';
        }
      });
    } else {
      firebase.auth().signInAnonymously();
    }
  });

  function buatAkun() {
    const nama = document.getElementById('namaBaru').value;
    if (!nama) return alert('Nama wajib diisi.');
    firebase.database().ref('akun/' + uid).set({ nama: nama, uang: 0 }).then(() => {
      location.reload();
    });
  }

  function kirimChat() {
    const teks = document.getElementById('pesanInput').value;
    if (!teks) return;
    firebase.database().ref('chat').push({ nama: namaPengguna, pesan: teks });
    document.getElementById('pesanInput').value = "";
  }

  function loadChat() {
    firebase.database().ref('chat').on('child_added', snap => {
      const { nama, pesan } = snap.val();
      const box = document.getElementById('chatBox');
      box.innerHTML += `<p><b>${nama}:</b> ${pesan}</p>`;
    });

    firebase.database().ref('akun/' + uid + '/uang').on('value', snap => {
      document.getElementById('saldo').innerText = 'Rp ' + snap.val().toLocaleString();
    });
  }

  function masukAdmin() {
    const pass = document.getElementById('adminPass').value;
    if (pass !== 'RFD1') return alert('Password salah');
    document.getElementById('adminKontrol').style.display = 'block';
    document.getElementById('namaAdmin').innerText = namaPengguna;
    tampilkanSemuaAkun();
    tampilkanTopTier();
  }

  function tampilkanSemuaAkun() {
    firebase.database().ref('akun').once('value').then(snap => {
      const ul = document.getElementById('daftarAkun');
      ul.innerHTML = '';
      snap.forEach(child => {
        const akun = child.val();
        const li = document.createElement('li');
        li.innerHTML = `
          ${akun.nama} - Rp ${akun.uang.toLocaleString()} 
          <button onclick="ubahNama('${child.key}', '${akun.nama}')">Ubah</button>
          <button onclick="hapusAkun('${child.key}')">Hapus</button>
        `;
        ul.appendChild(li);
      });
    });
  }

  function ubahNama(uidTarget, namaLama) {
    const baru = prompt("Nama baru:", namaLama);
    if (baru) firebase.database().ref('akun/' + uidTarget + '/nama').set(baru);
  }

  function hapusAkun(uidTarget) {
    firebase.database().ref('akun/' + uidTarget).remove().then(() => {
      alert('Akun dihapus');
      if (uid === uidTarget) location.reload();
    });
  }

  function tampilkanTopTier() {
    firebase.database().ref('akun').orderByChild('uang').limitToLast(3).once('value').then(snap => {
      const list = [];
      snap.forEach(child => list.push(child.val()));
      list.reverse();
      const ol = document.getElementById('topTier');
      ol.innerHTML = '';
      list.forEach((akun, i) => {
        const li = document.createElement('li');
        li.textContent = `${akun.nama} - Rp ${akun.uang.toLocaleString()}`;
        ol.appendChild(li);
      });
    });
  }
</script></body>
</html>
